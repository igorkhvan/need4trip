# üéØ –ö—Ä–∞—Ç–∫–∞—è —Å–≤–æ–¥–∫–∞ —Ä–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥–∞

## –ß—Ç–æ –±—ã–ª–æ —Å–¥–µ–ª–∞–Ω–æ

### 1. **–£–Ω–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞–Ω—ã —Ç–∏–ø—ã** ‚úÖ
- –°–æ–∑–¥–∞–Ω—ã `CityHydrated` –∏ `CurrencyHydrated`
- –í—Å–µ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å—ã (`Event`, `Club`, `User`) —Ç–µ–ø–µ—Ä—å –∏—Å–ø–æ–ª—å–∑—É—é—Ç –µ–¥–∏–Ω—ã–µ —Ç–∏–ø—ã

### 2. **–°–æ–∑–¥–∞–Ω –º–æ–¥—É–ª—å hydration utilities** ‚úÖ
**–§–∞–π–ª:** `src/lib/utils/hydration.ts`

–¢—Ä–∏ —É–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏:
- `hydrateCities()` ‚Äî batch loading –≥–æ—Ä–æ–¥–æ–≤
- `hydrateCurrencies()` ‚Äî batch loading –≤–∞–ª—é—Ç  
- `hydrateCitiesAndCurrencies()` ‚Äî –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω–∞—è –∑–∞–≥—Ä—É–∑–∫–∞ –æ–±–æ–∏—Ö

### 3. **–£—Å—Ç—Ä–∞–Ω–µ–Ω–∞ N+1 –ø—Ä–æ–±–ª–µ–º–∞** ‚úÖ
- –î–æ–±–∞–≤–ª–µ–Ω `getAllowedBrandsByEventIds()` –≤ `eventRepo.ts`
- –í–º–µ—Å—Ç–æ N –∑–∞–ø—Ä–æ—Å–æ–≤ ‚Üí 2 –∑–∞–ø—Ä–æ—Å–∞ –¥–ª—è –≤—Å–µ—Ö —Å–æ–±—ã—Ç–∏–π

### 4. **–û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω—ã —Å–µ—Ä–≤–∏—Å—ã** ‚úÖ

#### Events service:
```typescript
// –î–û: ~35 —Å—Ç—Ä–æ–∫, N+1 –ø—Ä–æ–±–ª–µ–º–∞
// –ü–û–°–õ–ï: ~15 —Å—Ç—Ä–æ–∫, 3 –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω—ã—Ö –∑–∞–ø—Ä–æ—Å–∞
const [counts, allowedBrandsMap, eventsWithHydration] = await Promise.all([
  getParticipantsCountByEventIds(eventIds),
  getAllowedBrandsByEventIds(eventIds),
  hydrateCitiesAndCurrencies(filtered),
]);
```

#### Clubs service:
```typescript
// –î–û: ~30 —Å—Ç—Ä–æ–∫ –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–Ω–æ–≥–æ –∫–æ–¥–∞
// –ü–û–°–õ–ï: 4 —Å—Ç—Ä–æ–∫–∏
const clubs = await listClubsRepo();
const domainClubs = clubs.map(mapDbClubToDomain);
return hydrateCities(domainClubs);
```

---

## üìä –†–µ–∑—É–ª—å—Ç–∞—Ç—ã

### –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å
- **–ó–∞–≥—Ä—É–∑–∫–∞ 10 —Å–æ–±—ã—Ç–∏–π:** 22 –∑–∞–ø—Ä–æ—Å–∞ ‚Üí **3 –∑–∞–ø—Ä–æ—Å–∞** (-86%)
- **–ó–∞–≥—Ä—É–∑–∫–∞ 50 –∫–ª—É–±–æ–≤:** 51 –∑–∞–ø—Ä–æ—Å ‚Üí **2 –∑–∞–ø—Ä–æ—Å–∞** (-96%)

### –ö–æ–¥
- **–î—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ:** –£—Å—Ç—Ä–∞–Ω–µ–Ω–æ –ø–æ–ª–Ω–æ—Å—Ç—å—é
- **–ß–∏—Ç–∞–µ–º–æ—Å—Ç—å:** –ó–Ω–∞—á–∏—Ç–µ–ª—å–Ω–æ —É–ª—É—á—à–µ–Ω–∞
- **–¢–∏–ø–æ–±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å:** 100% TypeScript

### –ö–∞—á–µ—Å—Ç–≤–æ
- ‚úÖ –°–±–æ—Ä–∫–∞ –±–µ–∑ –æ—à–∏–±–æ–∫
- ‚úÖ –õ–∏–Ω—Ç–µ—Ä –±–µ–∑ –æ—à–∏–±–æ–∫
- ‚úÖ –ì–æ—Ç–æ–≤–æ –∫ –¥–µ–ø–ª–æ—é

---

## üìÅ –ò–∑–º–µ–Ω—ë–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã

**–ù–æ–≤—ã–µ:**
- `src/lib/utils/hydration.ts`

**–û–±–Ω–æ–≤–ª—ë–Ω–Ω—ã–µ:**
- `src/lib/types/city.ts`
- `src/lib/types/currency.ts`
- `src/lib/types/event.ts`
- `src/lib/types/club.ts`
- `src/lib/types/user.ts`
- `src/lib/db/eventRepo.ts`
- `src/lib/services/events.ts`
- `src/lib/services/clubs.ts`

---

## üéØ –ö–ª—é—á–µ–≤—ã–µ —É–ª—É—á—à–µ–Ω–∏—è

1. ‚úÖ **–ö–æ–Ω—Å–∏—Å—Ç–µ–Ω—Ç–Ω–æ—Å—Ç—å** ‚Äî –µ–¥–∏–Ω—ã–µ —Ç–∏–ø—ã –∏ –ø–æ–¥—Ö–æ–¥—ã
2. ‚úÖ **–ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å** ‚Äî —É—Å—Ç—Ä–∞–Ω–µ–Ω—ã N+1 –ø—Ä–æ–±–ª–µ–º—ã
3. ‚úÖ **–ß–∏—Ç–∞–µ–º–æ—Å—Ç—å** ‚Äî –º–µ–Ω—å—à–µ –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏—è
4. ‚úÖ **–ú–∞—Å—à—Ç–∞–±–∏—Ä—É–µ–º–æ—Å—Ç—å** ‚Äî –ª–µ–≥–∫–æ –¥–æ–±–∞–≤–ª—è—Ç—å –Ω–æ–≤—ã–µ —Å–ø—Ä–∞–≤–æ—á–Ω–∏–∫–∏

**–ü–æ–¥—Ä–æ–±–Ω—ã–π –æ—Ç—á—ë—Ç:** `docs/REFACTORING_REPORT.md`

