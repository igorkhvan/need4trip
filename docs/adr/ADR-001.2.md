# ADR-001.2 — Admin Context

**Status:** Accepted  
**Date:** 2026-01-29  
**Extends:** ADR-001, ADR-001.1  
**Decision Scope:** Admin tools (`/api/admin/*`)  
**Owner:** Platform / Architecture

---

## 1. Context

ADR-001 and ADR-001.1 established the canonical authentication context model for **user-initiated** domains (Clubs, Billing, Events, Profile).

SSOT_ARCHITECTURE.md §8.3 defines a platform-level auth context taxonomy with three context types:

* **User Context** — end users interacting with the platform
* **Admin Context** — internal administrative actions
* **System Context** — background jobs and cron tasks

This ADR formalizes **Admin Context** as a first-class architectural concept.

### Current State

Admin routes (`/api/admin/*`) currently:

* authenticate via shared-secret header (`x-admin-secret`)
* perform administrative operations (cache clearing, data inspection)
* have no explicit auth context object
* have no audit identity (who performed the action is unknown)
* rely on implicit "not a user" convention

This approach was acceptable for early product stage but creates architectural ambiguity as the platform matures.

---

## 2. Problem Statement

### 2.1 Admin Actions Are Not User Actions

Admin operations have fundamentally different semantics:

* they are not initiated by end users
* they have no user identity to attribute
* they operate outside user-scoped data boundaries
* they require different authorization mechanisms

Treating admin routes as "routes without a user" (implicit absence) conflates two distinct concerns:

* unauthenticated/anonymous user requests
* authenticated administrative requests

### 2.2 Implicit Auth Is Fragile

Current admin authentication:

* validates `x-admin-secret` header inline in each route handler
* has no standard structure or contract
* provides no extensibility path (e.g., multiple admin users, role differentiation)
* leaves audit trail incomplete (action is logged, actor is not)

### 2.3 No Explicit Context Type

Services and routes cannot distinguish:

* "no user resolved" (anonymous)
* "admin context" (authenticated administrative actor)

This makes future architectural evolution difficult.

---

## 3. Decision

### 3.1 AdminContext Is a First-Class Auth Context

The system recognizes **AdminContext** as a distinct, first-class authentication context type alongside UserContext and SystemContext.

AdminContext represents:

* an authenticated administrative actor
* performing platform-level operations
* with secret-based authentication
* without end-user identity

### 3.2 AdminContext Is NOT a User Context

Admin routes:

* MUST NOT use `resolveCurrentUser()`
* MUST NOT perform user-scoped mutations
* MUST NOT access user-specific data without explicit justification

This separation is mandatory and non-negotiable.

### 3.3 Admin Routes MUST Explicitly Resolve AdminContext

Every admin route MUST explicitly authenticate and obtain AdminContext.

**Current implementation (Phase 1):**

```
validateAdminAuth(req) → AdminContext | throws 401
```

This validation:

* checks `x-admin-secret` header against `ADMIN_SECRET` env variable
* returns a minimal AdminContext on success
* throws `Unauthorized` on failure

**Rules:**

* Admin auth validation MUST be explicit in each route handler (not implicit via middleware alone)
* AdminContext resolution logic MUST be centralized (single canonical module)
* Direct header reading outside the canonical admin auth module is FORBIDDEN

---

## 4. AdminContext Definition (Conceptual)

### 4.1 Current Shape (Phase 1)

```typescript
interface AdminContext {
  type: 'admin';
  authenticatedVia: 'shared-secret';
  // No user identity in Phase 1
}
```

### 4.2 Semantics

| Property | Value | Description |
|----------|-------|-------------|
| `type` | `'admin'` | Discriminator for context type |
| `authenticatedVia` | `'shared-secret'` | Authentication mechanism used |

### 4.3 What AdminContext Does NOT Contain

In Phase 1, AdminContext explicitly lacks:

* user identity (no `userId`, no `email`)
* role or permission claims
* session identifier

These may be added in future phases (see §8 Out of Scope).

---

## 5. Audit Considerations

### 5.1 Minimum Audit Requirements

Admin actions MUST be logged with:

| Field | Source | Purpose |
|-------|--------|---------|
| `action` | Route identifier | What was done |
| `timestamp` | Server clock | When it happened |
| `requestId` | Correlation ID | Trace linkage |
| `result` | Success/failure | Outcome |

### 5.2 What MUST NOT Be Logged

* Secrets (`x-admin-secret` value)
* PII (unless strictly required and policy-approved)
* Full request/response payloads (unless sanitized)

### 5.3 Audit Identity Gap

In Phase 1, admin audit logs cannot answer "who did this?" — only "what was done?"

This is an accepted limitation tracked in ARCHITECTURAL_DEBT_LOG.md (DEBT-005).

Resolution requires admin identity mechanism (see §8 Out of Scope).

---

## 6. Scope of Enforcement

### 6.1 In Scope

This ADR applies to:

* `/api/admin/cache/clear`
* Any future `/api/admin/*` endpoints
* Any internal tooling that requires admin-level access

### 6.2 Out of Scope

This ADR does NOT cover:

* User-facing routes (covered by ADR-001.1)
* Cron/system routes (separate context, separate ADR if formalized)
* UI components or client-side admin tooling

---

## 7. Consequences

### 7.1 Positive

* **Explicit context type** — Admin operations have a named, typed context
* **Clear separation** — User and Admin concerns are architecturally distinct
* **Extensibility path** — Future admin users/RBAC can extend AdminContext without rewriting
* **Audit foundation** — Minimum audit structure is defined and enforceable
* **No breaking changes** — Current implementation continues to work

### 7.2 Trade-offs

* **Audit identity gap** — Phase 1 cannot attribute actions to specific admins
* **Single shared secret** — Remains a single point of compromise until Phase 2
* **Implementation cost** — Existing admin routes may need refactoring to use canonical resolver

### 7.3 Migration Path

1. **Phase 1 (this ADR):** Formalize AdminContext concept, document current implementation
2. **Phase 2 (future):** Introduce admin identity mechanism
3. **Phase 3 (future):** Add admin roles/permissions if needed

---

## 8. Out of Scope

The following are explicitly **NOT addressed** by this ADR:

### 8.1 Admin User Accounts

* Named admin users
* Admin login flow
* Admin session management
* Admin JWT tokens

**Why deferred:** No operational need yet. Single shared secret suffices for current admin team size.

### 8.2 Role-Based Admin Permissions

* Admin roles (super-admin, read-only admin, etc.)
* Granular permission claims
* Permission enforcement middleware

**Why deferred:** All admins currently have equal access. Role differentiation adds complexity without current benefit.

### 8.3 Advanced Audit Trail

* Full actor attribution (which admin did what)
* Admin action history UI
* Compliance-grade audit logs
* Immutable audit storage

**Why deferred:** Requires admin identity mechanism first (§8.1).

---

## 9. Implementation Status

**Status:** Conceptual (Not Yet Implemented)

### 9.1 Current State

Admin routes currently validate `x-admin-secret` inline. No `AdminContext` type or canonical resolver exists in code.

### 9.2 Implementation Plan

When implementation begins:

1. Create `lib/auth/adminContext.ts` with `AdminContext` type
2. Create `validateAdminAuth(req)` canonical resolver
3. Refactor existing admin routes to use canonical resolver
4. Add structured audit logging for admin actions
5. Update SSOT_API.md with implementation details

### 9.3 Enforcement

* New admin routes MUST use canonical `validateAdminAuth(req)`
* Direct `x-admin-secret` header reading outside `lib/auth` is FORBIDDEN
* SSOT_API.md §2.3.2 is the normative reference for admin auth rules

---

## 10. References

| Document | Section | Relevance |
|----------|---------|-----------|
| ADR-001 | — | Canonical user auth model foundation |
| ADR-001.1 | §10.2 | Admin context explicitly out of scope for user auth |
| SSOT_ARCHITECTURE.md | §8.3 | Platform-level auth context taxonomy |
| SSOT_API.md | §2.3.2 | Admin route auth rules |
| ARCHITECTURAL_DEBT_LOG.md | DEBT-005 | Admin context formalization debt |

---

## 11. Status

**Accepted. Mandatory for all admin route work going forward.**

All new `/api/admin/*` endpoints MUST follow the principles established in this ADR. Existing endpoints should be migrated when touched.
