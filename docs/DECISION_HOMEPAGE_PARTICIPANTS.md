# ü§î –ê–ù–ê–õ–ò–ó: –î–æ–ª–∂–Ω—ã –ª–∏ —É—á–∞—Å—Ç–Ω–∏–∫–∏ –≤–∏–¥–µ—Ç—å unlisted —Å–æ–±—ã—Ç–∏—è –Ω–∞ homepage?

**–í–æ–ø—Ä–æ—Å:** –ü–æ—á–µ–º—É —É—á–∞—Å—Ç–Ω–∏–∫ unlisted —Å–æ–±—ã—Ç–∏—è –ù–ï –≤–∏–¥–∏—Ç –µ–≥–æ –Ω–∞ homepage?

---

## üìã –ß–ê–°–¢–¨ 1: –¢–µ–∫—É—â–∞—è –ª–æ–≥–∏–∫–∞

### **Homepage –Ω–∞–∑–Ω–∞—á–µ–Ω–∏–µ:**
```
Homepage = "–ü—Ä–µ–¥—Å—Ç–æ—è—â–∏–µ –ø–æ–µ–∑–¥–∫–∏" (–ø—É–±–ª–∏—á–Ω–∞—è –≤–∏—Ç—Ä–∏–Ω–∞)
```

**–¢–µ–∫—É—â–∞—è —Ñ–∏–ª–æ—Å–æ—Ñ–∏—è:**
- –ü–æ–∫–∞–∑—ã–≤–∞—Ç—å **–ø—É–±–ª–∏—á–Ω–æ –∏–Ω—Ç–µ—Ä–µ—Å–Ω—ã–µ** —Å–æ–±—ã—Ç–∏—è
- –ü–æ–∫–∞–∑—ã–≤–∞—Ç—å **—Å–≤–æ–∏ —Å–æ–±—Å—Ç–≤–µ–Ω–Ω—ã–µ** —Å–æ–±—ã—Ç–∏—è (–≤–ª–∞–¥–µ–ª–µ—Ü)
- –ù–ï –ø–æ–∫–∞–∑—ã–≤–∞—Ç—å **—á—É–∂–∏–µ –∑–∞–∫—Ä—ã—Ç—ã–µ** —Å–æ–±—ã—Ç–∏—è (–¥–∞–∂–µ –µ—Å–ª–∏ —É—á–∞—Å—Ç–Ω–∏–∫)

---

## üìã –ß–ê–°–¢–¨ 2: –ê—Ä–≥—É–º–µ–Ω—Ç—ã –ó–ê –∏ –ü–†–û–¢–ò–í

### **–ü–†–û–¢–ò–í –ø–æ–∫–∞–∑–∞ —É—á–∞—Å—Ç–Ω–∏–∫–∞–º (—Ç–µ–∫—É—â–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è):**

**–ê—Ä–≥—É–º–µ–Ω—Ç 1: –ü—Ä–∏–≤–∞—Ç–Ω–æ—Å—Ç—å**
- Unlisted —Å–æ–±—ã—Ç–∏–µ = "—Å–∫—Ä—ã—Ç–æ–µ" (–Ω–µ –≤ –ø—É–±–ª–∏—á–Ω—ã—Ö —Å–ø–∏—Å–∫–∞—Ö)
- –ï—Å–ª–∏ —É—á–∞—Å—Ç–Ω–∏–∫ –≤–∏–¥–∏—Ç –Ω–∞ homepage ‚Üí —Ä–∞—Å–∫—Ä—ã–≤–∞–µ—Ç—Å—è –µ–≥–æ —É—á–∞—Å—Ç–∏–µ
- –î—Ä—É–≥–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –º–æ–≥—É—Ç –≤–∏–¥–µ—Ç—å —ç–∫—Ä–∞–Ω —É—á–∞—Å—Ç–Ω–∏–∫–∞

**–ê—Ä–≥—É–º–µ–Ω—Ç 2: –°–µ–º–∞–Ω—Ç–∏–∫–∞ homepage**
- Homepage = "–ø—É–±–ª–∏—á–Ω—ã–µ –ø—Ä–µ–¥—Å—Ç–æ—è—â–∏–µ –ø–æ–µ–∑–¥–∫–∏"
- Unlisted —Å–æ–±—ã—Ç–∏—è –ù–ï –ø—É–±–ª–∏—á–Ω—ã –ø–æ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—é
- –î–ª—è –ª–∏—á–Ω—ã—Ö —Å–æ–±—ã—Ç–∏–π –µ—Å—Ç—å `/events` (–ø–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—ã–π —Å–ø–∏—Å–æ–∫)

**–ê—Ä–≥—É–º–µ–Ω—Ç 3: –ö–æ–Ω—Å–∏—Å—Ç–µ–Ω—Ç–Ω–æ—Å—Ç—å —Å –¥–∏–∑–∞–π–Ω–æ–º**
- Unlisted = "—Å–∫—Ä—ã—Ç–æ –∏–∑ —Å–ø–∏—Å–∫–æ–≤, –¥–æ—Å—Ç—É–ø–Ω–æ –ø–æ —Å—Å—ã–ª–∫–µ"
- Homepage = —Å–ø–∏—Å–æ–∫ ‚Üí unlisted –Ω–µ –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è

---

### **–ó–ê –ø–æ–∫–∞–∑ —É—á–∞—Å—Ç–Ω–∏–∫–∞–º:**

**–ê—Ä–≥—É–º–µ–Ω—Ç 1: UX —É–¥–æ–±—Å—Ç–≤–æ**
- –£—á–∞—Å—Ç–Ω–∏–∫ –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–ª—Å—è ‚Üí —Ö–æ—á–µ—Ç –≤–∏–¥–µ—Ç—å —Å–æ–±—ã—Ç–∏–µ
- Homepage = –±—ã—Å—Ç—Ä—ã–π –¥–æ—Å—Ç—É–ø –∫ –ø—Ä–µ–¥—Å—Ç–æ—è—â–∏–º –ø–æ–µ–∑–¥–∫–∞–º
- –ù–µ—É–¥–æ–±–Ω–æ –∏–¥—Ç–∏ –≤ `/events` –¥–ª—è –∫–∞–∂–¥–æ–≥–æ —Å–æ–±—ã—Ç–∏—è

**–ê—Ä–≥—É–º–µ–Ω—Ç 2: –û–∂–∏–¥–∞–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è**
- "–Ø –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–ª—Å—è, –ø–æ—á–µ–º—É –Ω–µ –≤–∏–∂—É —Å–æ–±—ã—Ç–∏–µ?"
- Unlisted ‚â† restricted (–Ω–µ —Ç—Ä–µ–±—É–µ—Ç —Å–ø–µ—Ü–∏–∞–ª—å–Ω–æ–≥–æ –¥–æ—Å—Ç—É–ø–∞)
- –†–∞–∑ –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–ª—Å—è ‚Üí –∏–º–µ—é –ø—Ä–∞–≤–æ –≤–∏–¥–µ—Ç—å

**–ê—Ä–≥—É–º–µ–Ω—Ç 3: –ê–Ω–∞–ª–æ–≥–∏—è —Å –≤–ª–∞–¥–µ–ª—å—Ü–µ–º**
- –í–ª–∞–¥–µ–ª–µ—Ü –≤–∏–¥–∏—Ç —Å–≤–æ–∏ unlisted –Ω–∞ homepage
- –£—á–∞—Å—Ç–Ω–∏–∫ —Ç–æ–∂–µ "–∏–º–µ–µ—Ç –æ—Ç–Ω–æ—à–µ–Ω–∏–µ" –∫ —Å–æ–±—ã—Ç–∏—é
- –ü–æ—á–µ–º—É —Ä–∞–∑–Ω—ã–µ –ø—Ä–∞–≤–∏–ª–∞?

---

## üìã –ß–ê–°–¢–¨ 3: –í–∞—Ä–∏–∞–Ω—Ç—ã —Ä–µ—à–µ–Ω–∏—è

### **–í–∞—Ä–∏–∞–Ω—Ç A: –£—á–∞—Å—Ç–Ω–∏–∫–∏ –ù–ï –≤–∏–¥—è—Ç (—Ç–µ–∫—É—â–∏–π)** ‚ö†Ô∏è

```typescript
export function isVisibleOnHomepage(
  event: Event,
  currentUser: CurrentUser | null
): boolean {
  // Public ‚Üí –≤—Å–µ–º
  if (isPubliclyVisible(event)) return true;
  
  // Owner ‚Üí –≤–∏–¥–∏—Ç —Å–≤–æ–∏
  if (currentUser && event.createdByUserId === currentUser.id) {
    return true;
  }
  
  // Participants ‚Üí –ù–ï –≤–∏–¥—è—Ç unlisted –Ω–∞ homepage
  return false;
}
```

**–õ–æ–≥–∏–∫–∞:**
- Homepage = –ø—É–±–ª–∏—á–Ω–∞—è –≤–∏—Ç—Ä–∏–Ω–∞
- –õ–∏—á–Ω—ã–µ —Å–æ–±—ã—Ç–∏—è ‚Üí –≤ `/events`

---

### **–í–∞—Ä–∏–∞–Ω—Ç B: –£—á–∞—Å—Ç–Ω–∏–∫–∏ –í–ò–î–Ø–¢** ‚≠ê –†–ï–ö–û–ú–ï–ù–î–£–ï–¢–°–Ø

```typescript
export function isVisibleOnHomepage(
  event: Event,
  currentUser: CurrentUser | null,
  participantEventIds: Set<string> // ‚Üê –î–æ–±–∞–≤–∏–ª–∏ –ø–∞—Ä–∞–º–µ—Ç—Ä
): boolean {
  // Public ‚Üí –≤—Å–µ–º
  if (isPubliclyVisible(event)) return true;
  
  // Owner ‚Üí –≤–∏–¥–∏—Ç —Å–≤–æ–∏
  if (currentUser && event.createdByUserId === currentUser.id) {
    return true;
  }
  
  // Participant ‚Üí –≤–∏–¥–∏—Ç —Å–æ–±—ã—Ç–∏—è –≥–¥–µ –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω
  if (participantEventIds.has(event.id)) {
    return true;
  }
  
  return false;
}
```

**–õ–æ–≥–∏–∫–∞:**
- Homepage = "–º–æ–∏ –ø—Ä–µ–¥—Å—Ç–æ—è—â–∏–µ –ø–æ–µ–∑–¥–∫–∏"
- –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –≤—Å—ë, –∫ —á–µ–º—É —É –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –µ—Å—Ç—å –æ—Ç–Ω–æ—à–µ–Ω–∏–µ

---

## üìã –ß–ê–°–¢–¨ 4: –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è

**–ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –í–∞—Ä–∏–∞–Ω—Ç B: –£—á–∞—Å—Ç–Ω–∏–∫–∏ –í–ò–î–Ø–¢**

**–ü—Ä–∏—á–∏–Ω—ã:**

1. **UX —É–ª—É—á—à–∞–µ—Ç—Å—è:**
   - –£—á–∞—Å—Ç–Ω–∏–∫ —Å—Ä–∞–∑—É –≤–∏–¥–∏—Ç —Å–≤–æ–∏ —Å–æ–±—ã—Ç–∏—è
   - –ú–µ–Ω—å—à–µ –∫–ª–∏–∫–æ–≤ –¥–ª—è –¥–æ—Å—Ç—É–ø–∞
   - –ò–Ω—Ç—É–∏—Ç–∏–≤–Ω–æ –ø–æ–Ω—è—Ç–Ω–æ

2. **–ö–æ–Ω—Å–∏—Å—Ç–µ–Ω—Ç–Ω–æ —Å `/events`:**
   - `/events` –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç —Å–æ–±—ã—Ç–∏—è —É—á–∞—Å—Ç–Ω–∏–∫–∞
   - Homepage –¥–æ–ª–∂–µ–Ω –ø–æ–∫–∞–∑—ã–≤–∞—Ç—å —Ç–æ –∂–µ —Å–∞–º–æ–µ (filtered)
   - –ï–¥–∏–Ω–∞—è –ª–æ–≥–∏–∫–∞

3. **–ü—Ä–∏–≤–∞—Ç–Ω–æ—Å—Ç—å –Ω–µ –Ω–∞—Ä—É—à–∞–µ—Ç—Å—è:**
   - –°–æ–±—ã—Ç–∏–µ –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è **—Ç–æ–ª—å–∫–æ** —Å–∞–º–æ–º—É —É—á–∞—Å—Ç–Ω–∏–∫—É
   - –î—Ä—É–≥–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –µ–≥–æ –ù–ï –≤–∏–¥—è—Ç (unlisted —Å–∫—Ä—ã—Ç)
   - –í–ª–∞–¥–µ–ª–µ—Ü —É–∂–µ –≤–∏–¥–∏—Ç –≤—Å–µ—Ö —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤

4. **–ê–Ω–∞–ª–æ–≥–∏—è —Å –≤–ª–∞–¥–µ–ª—å—Ü–µ–º:**
   - –í–ª–∞–¥–µ–ª–µ—Ü –≤–∏–¥–∏—Ç —Å–≤–æ–∏ unlisted
   - –£—á–∞—Å—Ç–Ω–∏–∫ —Ç–æ–∂–µ "–∏–º–µ–µ—Ç –æ—Ç–Ω–æ—à–µ–Ω–∏–µ"
   - –°–ø—Ä–∞–≤–µ–¥–ª–∏–≤–æ

---

## üìã –ß–ê–°–¢–¨ 5: –†–µ–∞–ª–∏–∑–∞—Ü–∏—è –í–∞—Ä–∏–∞–Ω—Ç–∞ B

### **–ò–∑–º–µ–Ω–µ–Ω–∏–µ 1: –§—É–Ω–∫—Ü–∏—è isVisibleOnHomepage()**

```typescript
// src/lib/utils/eventVisibility.ts

/**
 * Check if event should be visible on homepage
 * 
 * Homepage shows:
 * - Public events (everyone)
 * - User's own events (owner, including unlisted/restricted)
 * - Events where user is participant (including unlisted)
 * 
 * @param event Event to check
 * @param currentUser Current user (or null if anonymous)
 * @param participantEventIds Set of event IDs where user is participant
 * @returns true if event should appear on homepage
 */
export function isVisibleOnHomepage(
  event: Event,
  currentUser: CurrentUser | null,
  participantEventIds?: Set<string>
): boolean {
  // 1. Public events ‚Üí everyone
  if (isPubliclyVisible(event)) return true;
  
  // 2. Owner sees their own events
  if (currentUser && event.createdByUserId === currentUser.id) {
    return true;
  }
  
  // 3. Participant sees events they're registered for
  if (participantEventIds && participantEventIds.has(event.id)) {
    return true;
  }
  
  return false;
}
```

### **–ò–∑–º–µ–Ω–µ–Ω–∏–µ 2: Homepage –∫–æ–º–ø–æ–Ω–µ–Ω—Ç**

```typescript
// src/app/(marketing)/_components/upcoming-events-async.tsx

export async function UpcomingEventsAsync() {
  const currentUser = await getCurrentUserSafe();
  const eventsData = await listVisibleEventsForUser(currentUser?.id ?? null);
  
  // –î–ª—è —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏ –Ω—É–∂–Ω—ã participant IDs
  const participantEventIds = new Set(
    eventsData
      .filter(e => /* check if user is participant */)
      .map(e => e.id)
  );
  
  const upcomingEvents = eventsData
    .filter((e) => {
      const eventDate = new Date(e.dateTime);
      return isVisibleOnHomepage(e, currentUser, participantEventIds) && eventDate >= now;
    })
    .sort(...)
    .slice(0, 3);
```

**–ü–†–û–ë–õ–ï–ú–ê:** –ù—É–∂–Ω–æ –ø–µ—Ä–µ–¥–∞—Ç—å `participantEventIds` –≤ homepage.

---

## üìã –ß–ê–°–¢–¨ 6: –£–ø—Ä–æ—â—ë–Ω–Ω–æ–µ —Ä–µ—à–µ–Ω–∏–µ ‚≠ê

**–ü—Ä–æ–±–ª–µ–º–∞:** `participantEventIds` –Ω–µ –¥–æ—Å—Ç—É–ø–Ω—ã –≤ homepage –±–µ–∑ –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ–≥–æ –∑–∞–ø—Ä–æ—Å–∞.

**–†–µ—à–µ–Ω–∏–µ:** –ü–æ–ª–∞–≥–∞—Ç—å—Å—è –Ω–∞ —Ç–æ, —á—Ç–æ `listVisibleEventsForUser()` —É–∂–µ –≤–µ—Ä–Ω—É–ª–∞ –ø—Ä–∞–≤–∏–ª—å–Ω—ã–µ —Å–æ–±—ã—Ç–∏—è.

```typescript
export function isVisibleOnHomepage(
  event: Event,
  currentUser: CurrentUser | null
): boolean {
  // 1. Public events ‚Üí everyone
  if (isPubliclyVisible(event)) return true;
  
  // 2. If user is authenticated and event is in the list
  // it means they have access (owner, participant, or explicit access)
  if (currentUser) {
    return true; // Trust listVisibleEventsForUser() filtering
  }
  
  return false;
}
```

**–õ–æ–≥–∏–∫–∞:**
- `listVisibleEventsForUser()` —É–∂–µ –æ—Ç—Ñ–∏–ª—å—Ç—Ä–æ–≤–∞–ª–∞ —Å–æ–±—ã—Ç–∏—è
- –ï—Å–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω –∏ —Å–æ–±—ã—Ç–∏–µ –≤ —Å–ø–∏—Å–∫–µ ‚Üí –ø–æ–∫–∞–∑—ã–≤–∞–µ–º
- –ê–Ω–æ–Ω–∏–º—ã –≤–∏–¥—è—Ç —Ç–æ–ª—å–∫–æ public (—Ç.–∫. `listVisibleEventsForUser(null)` –≤–µ—Ä–Ω—ë—Ç —Ç–æ–ª—å–∫–æ public)

---

## üéØ –§–ò–ù–ê–õ–¨–ù–ê–Ø –†–ï–ö–û–ú–ï–ù–î–ê–¶–ò–Ø

**–ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —É–ø—Ä–æ—â—ë–Ω–Ω–æ–µ —Ä–µ—à–µ–Ω–∏–µ:**

```typescript
export function isVisibleOnHomepage(
  event: Event,
  currentUser: CurrentUser | null
): boolean {
  // Public events visible to everyone
  if (isPubliclyVisible(event)) return true;
  
  // For authenticated users: trust listVisibleEventsForUser()
  // If event is in the list, user has relationship to it
  // (owner, participant, or explicit access)
  if (currentUser) {
    return true;
  }
  
  return false;
}
```

**–†–µ–∑—É–ª—å—Ç–∞—Ç:**
- ‚úÖ –£—á–∞—Å—Ç–Ω–∏–∫–∏ **–í–ò–î–Ø–¢** —Å–≤–æ–∏ unlisted —Å–æ–±—ã—Ç–∏—è –Ω–∞ homepage
- ‚úÖ –í–ª–∞–¥–µ–ª—å—Ü—ã **–í–ò–î–Ø–¢** —Å–≤–æ–∏ —Å–æ–±—ã—Ç–∏—è
- ‚úÖ –ê–Ω–æ–Ω–∏–º—ã **–í–ò–î–Ø–¢** —Ç–æ–ª—å–∫–æ public
- ‚úÖ –ü—Ä–æ—Å—Ç–æ–µ —Ä–µ—à–µ–Ω–∏–µ (–Ω–µ –Ω—É–∂–Ω—ã –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã)

---

**–ß—Ç–æ –≤—ã–±–∏—Ä–∞–µ–º?**
1. **–í–∞—Ä–∏–∞–Ω—Ç A:** –£—á–∞—Å—Ç–Ω–∏–∫–∏ –ù–ï –≤–∏–¥—è—Ç unlisted (—Ç–µ–∫—É—â–∏–π –ø–ª–∞–Ω)
2. **–í–∞—Ä–∏–∞–Ω—Ç B:** –£—á–∞—Å—Ç–Ω–∏–∫–∏ –í–ò–î–Ø–¢ unlisted (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ–º—ã–π)
