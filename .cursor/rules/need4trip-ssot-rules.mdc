---
alwaysApply: true
---

# Need4Trip - SSOT Rules (Single Source of Truth)

**Last Updated:** 25 –¥–µ–∫–∞–±—Ä—è 2024  
**Status:** Production Ready ‚úÖ

---

## üéØ –ì–õ–ê–í–ù–´–ô –ü–†–ò–ù–¶–ò–ü

> **–¢–†–ò SSOT –î–û–ö–£–ú–ï–ù–¢–ê ‚Äî –ï–î–ò–ù–°–¢–í–ï–ù–ù–´–ï –∏—Å—Ç–æ—á–Ω–∏–∫–∏ –∏—Å—Ç–∏–Ω—ã:**
> 1. `docs/ARCHITECTURE.md` ‚Äî –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞, –ø–∞—Ç—Ç–µ—Ä–Ω—ã, ownership
> 2. `docs/DATABASE.md` ‚Äî —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –ë–î, —Ç–∞–±–ª–∏—Ü—ã, –∏–Ω–¥–µ–∫—Å—ã, RLS
> 3. `docs/BILLING_SYSTEM_ANALYSIS.md` ‚Äî –±–∏–ª–ª–∏–Ω–≥, —Ç–∞—Ä–∏—Ñ—ã, –ª–∏–º–∏—Ç—ã

---

## üîÑ –°–ò–ù–•–†–û–ù–ò–ó–ê–¶–ò–Ø MEMORY ‚Üî RULES FILES

**–ö–†–ò–¢–ò–ß–ù–û:** Memory –ø—Ä–∞–≤–∏–ª–∞ (–≤ –±–∞–∑–µ Cursor) –∏ Rules —Ñ–∞–π–ª—ã (`.cursor/rules/*.mdc`) –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å –í–°–ï–ì–î–ê —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä–æ–≤–∞–Ω—ã.

### –ü–û–°–õ–ï —Å–æ–∑–¥–∞–Ω–∏—è/–æ–±–Ω–æ–≤–ª–µ–Ω–∏—è Memory –ø—Ä–∞–≤–∏–ª–∞:
1. ‚úÖ –ü—Ä–æ–≤–µ—Ä—å —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–∏–π rules —Ñ–∞–π–ª
2. ‚úÖ –û–±–Ω–æ–≤–∏ —Ñ–∞–π–ª —Å –Ω–æ–≤–æ–π –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–µ–π –∏–∑ Memory
3. ‚úÖ –ö–æ–º–º–∏—Ç—å –æ–±–Ω–æ–≤–ª–µ–Ω–Ω—ã–π rules —Ñ–∞–π–ª
4. ‚úÖ –í commit message: "sync Memory ‚Üí Rules"

### –ü–û–°–õ–ï –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è rules —Ñ–∞–π–ª–∞:
1. ‚úÖ –ü—Ä–æ–≤–µ—Ä—å —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–∏–µ Memory –ø—Ä–∞–≤–∏–ª–∞
2. ‚úÖ –û–±–Ω–æ–≤–∏ Memory —á–µ—Ä–µ–∑ `update_memory` –µ—Å–ª–∏ –Ω—É–∂–Ω–æ
3. ‚úÖ –£–±–µ–¥–∏—Å—å —á—Ç–æ –Ω–µ—Ç —Ä–∞–∑–Ω–æ–≥–ª–∞—Å–∏–π

**Mapping:**
- DATABASE.md SSOT (Memory) ‚Üí `need4trip-ssot-rules.mdc` (—Å–µ–∫—Ü–∏—è DATABASE.md)
- BILLING SSOT (Memory) ‚Üí `need4trip-ssot-rules.mdc` (—Å–µ–∫—Ü–∏—è BILLING)
- ARCHITECTURE SSOT (Memory) ‚Üí `need4trip-ssot-rules.mdc` (—Å–µ–∫—Ü–∏—è ARCHITECTURE)

**–ü—Ä–∏—á–∏–Ω–∞:** Rules —Ñ–∞–π–ª—ã –≤–∏–¥–Ω—ã –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é, Memory ‚Äî —Ç–æ–ª—å–∫–æ AI. –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è = –∫–æ–Ω—Å–∏—Å—Ç–µ–Ω—Ç–Ω–æ—Å—Ç—å.

---

## üìã –û–ë–Ø–ó–ê–¢–ï–õ–¨–ù–´–ô WORKFLOW

### –ü–ï–†–ï–î –ª—é–±—ã–º –∏–∑–º–µ–Ω–µ–Ω–∏–µ–º:

1. **–û–ø—Ä–µ–¥–µ–ª–∏ –æ–±–ª–∞—Å—Ç—å:**
   - –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞/–ø–∞—Ç—Ç–µ—Ä–Ω—ã ‚Üí —á–∏—Ç–∞–π `ARCHITECTURE.md`
   - –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö ‚Üí —á–∏—Ç–∞–π `DATABASE.md`
   - –ë–∏–ª–ª–∏–Ω–≥/–ª–∏–º–∏—Ç—ã ‚Üí —á–∏—Ç–∞–π `BILLING_SYSTEM_ANALYSIS.md`

2. **–ò–∑—É—á–∏ SSOT:**
   - –ù–∞–π–¥–∏ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–∏–π —Ä–∞–∑–¥–µ–ª
   - –ü–æ–π–º–∏ —Ç–µ–∫—É—â–∏–µ –ø—Ä–∞–≤–∏–ª–∞ –∏ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è
   - –ü—Ä–æ–≤–µ—Ä—å ownership map

3. **–°–ø–ª–∞–Ω–∏—Ä—É–π –∏–∑–º–µ–Ω–µ–Ω–∏—è:**
   - –°–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—Ç –ª–∏ –æ–Ω–∏ –ø—Ä–∏–Ω—Ü–∏–ø–∞–º SSOT?
   - –ù–µ –Ω–∞—Ä—É—à–∞—é—Ç –ª–∏ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ –∫–æ–Ω—Ç—Ä–∞–∫—Ç—ã?
   - –û–±—Ä–∞—Ç–Ω–∞—è —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å –≥–∞—Ä–∞–Ω—Ç–∏—Ä–æ–≤–∞–Ω–∞?

### –ü–û–°–õ–ï –∏–∑–º–µ–Ω–µ–Ω–∏—è:

1. **–û–±–Ω–æ–≤–∏ SSOT:**
   - –ï—Å–ª–∏ –∏–∑–º–µ–Ω–∏–ª–∞—Å—å –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ ‚Üí –æ–±–Ω–æ–≤–∏ `ARCHITECTURE.md`
   - –ï—Å–ª–∏ –∏–∑–º–µ–Ω–∏–ª–∞—Å—å –ë–î ‚Üí –æ–±–Ω–æ–≤–∏ `DATABASE.md`
   - –ï—Å–ª–∏ –∏–∑–º–µ–Ω–∏–ª—Å—è –±–∏–ª–ª–∏–Ω–≥ ‚Üí –æ–±–Ω–æ–≤–∏ `BILLING_SYSTEM_ANALYSIS.md`

2. **–ö–æ–º–º–∏—Ç:**
   - –ö–æ–¥ + –æ–±–Ω–æ–≤–ª–µ–Ω–Ω—ã–π SSOT –≤ –û–î–ù–û–ú –∫–æ–º–º–∏—Ç–µ
   - –ö–æ–º–º–∏—Ç message —É–∫–∞–∑—ã–≤–∞–µ—Ç —á—Ç–æ –æ–±–Ω–æ–≤–ª–µ–Ω SSOT

3. **Verification:**
   - `npx tsc --noEmit` ‚úÖ
   - `npm run build` ‚úÖ
   - SSOT –æ—Ç—Ä–∞–∂–∞–µ—Ç –∞–∫—Ç—É–∞–ª—å–Ω–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ ‚úÖ

---

## üèóÔ∏è ARCHITECTURE.md (SSOT)

**–ß—Ç–æ —Å–æ–¥–µ—Ä–∂–∏—Ç:**
- Module ownership map (–∫—Ç–æ –æ—Ç–≤–µ—á–∞–µ—Ç –∑–∞ —á—Ç–æ)
- Data access patterns (Repos ‚Üí Services ‚Üí API)
- Runtime boundaries (Server vs Client, Edge vs Node)
- Caching strategy (StaticCache –¥–ª—è reference data)
- Auth & currentUser rules
- Type safety contracts

**–ö–ª—é—á–µ–≤—ã–µ –ø–∞—Ç—Ç–µ—Ä–Ω—ã:**

```typescript
// ‚úÖ DB Access (SSOT: src/lib/db/client.ts)
const db = getAdminDb(); // –≥–∞—Ä–∞–Ω—Ç–∏—Ä–æ–≤–∞–Ω–Ω–æ non-null

// ‚úÖ Date/Time (SSOT: src/lib/utils/dates.ts)
import { formatDateTime, parseDateTime } from '@/lib/utils/dates';

// ‚úÖ Hydration (SSOT: src/lib/utils/hydration.ts)
const events = await hydrateCities(rawEvents);

// ‚úÖ Visibility (SSOT: src/lib/utils/eventVisibility.ts)
const canView = await canViewEvent(event, currentUser);

// ‚úÖ Permissions (SSOT: src/lib/utils/eventPermissions.ts)
const canRegister = await canRegisterForEvent(event, currentUser);

// ‚úÖ Caching (SSOT: src/lib/cache/staticCache.ts)
const cache = new StaticCache<T>({ ttl, name }, loader, keyExtractor);
```

**–ó–ê–ü–†–ï–©–ï–ù–û:**
- ‚ùå –î—É–±–ª–∏—Ä–æ–≤–∞—Ç—å –ª–æ–≥–∏–∫—É (–≤—Å–µ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑—É–π canonical –º–æ–¥—É–ª—å)
- ‚ùå UI ‚Üí Repository –Ω–∞–ø—Ä—è–º—É—é (—Ç–æ–ª—å–∫–æ —á–µ—Ä–µ–∑ Services)
- ‚ùå Server-only –∫–æ–¥ –≤ client components
- ‚ùå –ú–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã–µ —Å–ø–æ—Å–æ–±—ã –¥–µ–ª–∞—Ç—å –æ–¥–Ω–æ –∏ —Ç–æ –∂–µ

---

## üóÑÔ∏è DATABASE.md (SSOT)

**–ß—Ç–æ —Å–æ–¥–µ—Ä–∂–∏—Ç:**
- 20 —Ç–∞–±–ª–∏—Ü —Å –ø–æ–ª–Ω—ã–º–∏ CREATE TABLE —Å—Ö–µ–º–∞–º–∏
- Performance indexes (compound, covering, partial)
- RLS policies summary –¥–ª—è –≤—Å–µ—Ö –∑–∞—â–∏—â–µ–Ω–Ω—ã—Ö —Ç–∞–±–ª–∏—Ü
- Database functions & triggers
- Migration history (60+ –º–∏–≥—Ä–∞—Ü–∏–π)
- ERD –¥–∏–∞–≥—Ä–∞–º–º–∞ —Å–≤—è–∑–µ–π
- Maintenance rules

**SQL –ú–∏–≥—Ä–∞—Ü–∏–∏ (–°–¢–†–û–ì–û!):**

```bash
# –§–æ—Ä–º–∞—Ç –∏–º–µ–Ω–∏ (–û–ë–Ø–ó–ê–¢–ï–õ–¨–ù–û —Å timestamp):
supabase/migrations/YYYYMMDD_description.sql

# –ü—Ä–∏–º–µ—Ä:
supabase/migrations/20241225_add_event_tags.sql
```

**Workflow:**
1. –ß–∏—Ç–∞–π `DATABASE.md` –ø–µ—Ä–µ–¥ –∏–∑–º–µ–Ω–µ–Ω–∏–µ–º
2. –°–æ–∑–¥–∞–π –º–∏–≥—Ä–∞—Ü–∏—é —Å timestamp
3. –ü—Ä–∏–º–µ–Ω–∏ –º–∏–≥—Ä–∞—Ü–∏—é –≤ Supabase
4. –û–±–Ω–æ–≤–∏ `DATABASE.md` —Å –Ω–æ–≤–æ–π —Å—Ç—Ä—É–∫—Ç—É—Ä–æ–π
5. –ö–æ–º–º–∏—Ç—å –º–∏–≥—Ä–∞—Ü–∏—é + `DATABASE.md` –≤–º–µ—Å—Ç–µ

**–ó–ê–ü–†–ï–©–ï–ù–û:**
- ‚ùå SQL —Ñ–∞–π–ª—ã –±–µ–∑ timestamp –≤ –Ω–∞–∑–≤–∞–Ω–∏–∏
- ‚ùå SQL —Ñ–∞–π–ª—ã –≤ –∫–æ—Ä–Ω–µ –ø—Ä–æ–µ–∫—Ç–∞
- ‚ùå SQL —Ñ–∞–π–ª—ã —Å UPPERCASE –Ω–∞–∑–≤–∞–Ω–∏—è–º–∏ (APPLY_VIA_DASHBOARD*.sql)
- ‚ùå –í—Ä–µ–º–µ–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã —Ç–∏–ø–∞ `.temp_migrations/`
- ‚ùå –ò–∑–º–µ–Ω–µ–Ω–∏–µ —É–∂–µ –ø—Ä–∏–º–µ–Ω–µ–Ω–Ω—ã—Ö –º–∏–≥—Ä–∞—Ü–∏–π
- ‚ùå –ü—Ä—è–º—ã–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è –≤ –ë–î –±–µ–∑ –º–∏–≥—Ä–∞—Ü–∏–∏

---

## üí≥ BILLING_SYSTEM_ANALYSIS.md (SSOT)

**–ß—Ç–æ —Å–æ–¥–µ—Ä–∂–∏—Ç:**
- –¢–∞—Ä–∏—Ñ—ã (free, club_50, club_500, club_unlimited)
- –õ–∏–º–∏—Ç—ã –¥–ª—è –∫–∞–∂–¥–æ–≥–æ —Ç–∞—Ä–∏—Ñ–∞
- Enforcement –ª–æ–≥–∏–∫–∞ (enforceClubAction)
- PaywallError —Å—Ç—Ä—É–∫—Ç—É—Ä–∞
- Frontend –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è (PaywallModal)
- Grace period –ø—Ä–∞–≤–∏–ª–∞

**–ö–ª—é—á–µ–≤—ã–µ –ø—Ä–∏–Ω—Ü–∏–ø—ã:**

1. **Frontend –ù–ï —Ä–µ—à–∞–µ—Ç –ª–∏–º–∏—Ç—ã:**
   - –§—Ä–æ–Ω—Ç —Ç–æ–ª—å–∫–æ –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç UI
   - –†–µ–∞–≥–∏—Ä—É–µ—Ç –Ω–∞ 402 –æ—Ç backend
   - –ò—Å–ø–æ–ª—å–∑—É–µ—Ç `PaywallModal.tsx` (—Ç–∏–ø–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–π)

2. **Backend ‚Äî –µ–¥–∏–Ω—Å—Ç–≤–µ–Ω–Ω—ã–π –∏—Å—Ç–æ—á–Ω–∏–∫ –∏—Å—Ç–∏–Ω—ã:**
   - `enforceClubAction()` –≤ `src/lib/services/accessControl.ts`
   - –ü—Ä–æ–≤–µ—Ä—è–µ—Ç —Ç–µ–∫—É—â—É—é –ø–æ–¥–ø–∏—Å–∫—É –∫–ª—É–±–∞
   - Throws `PaywallError` (402) –µ—Å–ª–∏ –ª–∏–º–∏—Ç –ø—Ä–µ–≤—ã—à–µ–Ω

3. **Billing transactions ‚Äî —Ç–æ–ª—å–∫–æ –∞—É–¥–∏—Ç:**
   - –ù–ï —É—á–∞—Å—Ç–≤—É—é—Ç –≤ –ø—Ä–æ–≤–µ—Ä–∫–∞—Ö –¥–æ—Å—Ç—É–ø–∞
   - –ò—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è –¥–ª—è –∏—Å—Ç–æ—Ä–∏–∏ –ø–ª–∞—Ç–µ–∂–µ–π

**–ü—Ä–∏–º–µ—Ä –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è:**

```typescript
// Backend (API Route)
import { enforceClubAction } from '@/lib/services/accessControl';

await enforceClubAction({
  clubId: event.clubId,
  action: 'CREATE_EVENT_WITH_PARTICIPANTS',
  context: { eventParticipantsCount: 100 }
}); // throws PaywallError –µ—Å–ª–∏ –ø—Ä–µ–≤—ã—à–µ–Ω –ª–∏–º–∏—Ç

// Frontend (Component)
import { usePaywall } from '@/components/billing/PaywallModal';

const { showPaywall, PaywallModalComponent } = usePaywall();

try {
  await createEvent(...);
} catch (err) {
  if (err.response?.status === 402) {
    showPaywall(err.response.data.error.details);
  }
}

return <>{PaywallModalComponent}</>;
```

**–ó–ê–ü–†–ï–©–ï–ù–û:**
- ‚ùå –ü—Ä–æ–≤–µ—Ä–∫–∏ –ª–∏–º–∏—Ç–æ–≤ –Ω–∞ —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥–µ
- ‚ùå –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Å—Ç–∞—Ä—ã–π `paywall-modal.tsx` (—É–¥–∞–ª–µ–Ω)
- ‚ùå –ò–∑–º–µ–Ω—è—Ç—å –ª–æ–≥–∏–∫—É enforcement –±–µ–∑ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è SSOT

---

## üìÅ Session Documents (–í—Ä–µ–º–µ–Ω–Ω—ã–µ)

**–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ:** –ê–Ω–∞–ª–∏—Ç–∏—á–µ—Å–∫–∏–µ –¥–æ–∫—É–º–µ–Ω—Ç—ã –¥–ª—è –±–æ–ª—å—à–∏—Ö –∑–∞–¥–∞—á

**–°—Ç—Ä—É–∫—Ç—É—Ä–∞:**
```
docs/sessions/
‚îú‚îÄ‚îÄ YYYY-MM-DD-–Ω–∞–∑–≤–∞–Ω–∏–µ/
‚îÇ   ‚îú‚îÄ‚îÄ analysis.md       # –ù–∞—á–∞–ª—å–Ω—ã–π –∞–Ω–∞–ª–∏–∑
‚îÇ   ‚îú‚îÄ‚îÄ implementation.md # –î–µ—Ç–∞–ª–∏ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏
‚îÇ   ‚îú‚îÄ‚îÄ stages-N-M.md    # –ü—Ä–æ–º–µ–∂—É—Ç–æ—á–Ω—ã–µ –æ—Ç—á—ë—Ç—ã
‚îÇ   ‚îî‚îÄ‚îÄ complete.md      # –§–∏–Ω–∞–ª—å–Ω—ã–π –æ—Ç—á—ë—Ç
‚îî‚îÄ‚îÄ README.md            # –ü—Ä–∞–≤–∏–ª–∞ —Ä–∞–±–æ—Ç—ã
```

**Workflow:**
1. **–°–û–ó–î–ê–ù–ò–ï:** AI —Å–æ–∑–¥–∞—ë—Ç –ø–∞–ø–∫—É –¥–ª—è –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞ –±–æ–ª—å—à–æ–π –∑–∞–¥–∞—á–∏
2. **–ó–ê–í–ï–†–®–ï–ù–ò–ï:** –ö–ª—é—á–µ–≤—ã–µ insights –ø–µ—Ä–µ–Ω–æ—Å—è—Ç—Å—è –≤ SSOT
3. **CLEANUP:** Sessions —Å—Ç–∞—Ä—à–µ 30 –¥–Ω–µ–π –º–æ–∂–Ω–æ —É–¥–∞–ª—è—Ç—å

**–ü—Ä–∞–≤–∏–ª–∞:**
- ‚úÖ –°–æ–∑–¥–∞–≤–∞–π session –¥–ª—è –±–æ–ª—å—à–∏—Ö –∑–∞–¥–∞—á (–ù–ï –¥–ª—è –º–µ–ª–∫–∏—Ö –∏–∑–º–µ–Ω–µ–Ω–∏–π)
- ‚úÖ –ü–µ—Ä–µ–Ω–æ—Å–∏ insights –≤ SSOT –ø–æ—Å–ª–µ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è
- ‚úÖ –£–¥–∞–ª—è–π —Å—Ç–∞—Ä—ã–µ sessions –ø–µ—Ä–∏–æ–¥–∏—á–µ—Å–∫–∏
- ‚ùå –ù–ï –∏—Å–ø–æ–ª—å–∑—É–π sessions –∫–∞–∫ –∏—Å—Ç–æ—á–Ω–∏–∫ –∏—Å—Ç–∏–Ω—ã
- ‚ùå –ù–ï —Å—Å—ã–ª–∞–π—Å—è –Ω–∞ –Ω–∏—Ö –∏–∑ –∫–æ–¥–∞/–¥–æ–∫—É–º–µ–Ω—Ç–æ–≤
- ‚ùå –ù–ï —Ö—Ä–∞–Ω–∏ –∫—Ä–∏—Ç–∏—á–Ω—É—é –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é —Ç–æ–ª—å–∫–æ –≤ sessions

---

## üé® –î–∏–∑–∞–π–Ω-—Å–∏—Å—Ç–µ–º–∞ (/figma/)

**–°—Ç–∞—Ç—É—Å:** –ò—Å–∫–ª—é—á–µ–Ω–∞ –∏–∑ –±–∏–ª–¥–∞, –≤ .gitignore

**–î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è:** `/figma/src/DESIGN_SYSTEM.md`

**–¶–≤–µ—Ç–∞:**
- Primary: #FF6F2C (–æ—Ä–∞–Ω–∂–µ–≤—ã–π)
- Success: #22C55E, Warning: #F59E0B, Danger: #EF4444

**–¢–∏–ø–æ–≥—Ä–∞—Ñ–∏–∫–∞:**
- –®—Ä–∏—Ñ—Ç: Inter (Google Fonts)
- h1: 32px (desktop) / 36px (mobile)
- Body: 15px

**–ö–æ–º–ø–æ–Ω–µ–Ω—Ç—ã:**
- Button (4 –≤–∞—Ä–∏–∞–Ω—Ç–∞), Badge (6 —Ç–∏–ø–æ–≤), Card (3 —Ä–∞–∑–º–µ—Ä–∞)
- Modal (5 —Ä–∞–∑–º–µ—Ä–æ–≤), Input/Select (–≤—ã—Å–æ—Ç–∞ 48px)

**–ü—Ä–∞–≤–∏–ª–æ:** –ò—Å–ø–æ–ª—å–∑—É–π –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã –∏–∑ –¥–∏–∑–∞–π–Ω-—Å–∏—Å—Ç–µ–º—ã. Figma –ø–∞–ø–∫–∞ –ù–ï —á–∞—Å—Ç—å –æ—Å–Ω–æ–≤–Ω–æ–≥–æ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è.

---

## ‚úÖ Vercel Compatibility (–ö–†–ò–¢–ò–ß–ù–û!)

**Runtime boundaries:**

```typescript
// ‚úÖ Server-only utilities
import { getAdminDb } from '@/lib/db/client'; // OK –≤ API routes

// ‚ùå –ù–ò–ö–û–ì–î–ê –≤ client components
'use client';
import { supabaseAdmin } from '@/lib/db/client'; // ‚ùå –û–®–ò–ë–ö–ê –ë–ò–õ–î–ê
```

**–ü—Ä–∞–≤–∏–ª–∞:**
- Server-only –∫–æ–¥ –ù–ï –¥–æ–ª–∂–µ–Ω –∏–º–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å—Å—è –≤ `'use client'` –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞—Ö
- –£—Ç–∏–ª–∏—Ç—ã –¥–ª—è –æ–±–µ–∏—Ö —Å—Ç–æ—Ä–æ–Ω –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å pure functions
- No Node-only APIs –≤ Edge runtimes
- –ò–∑–æ–º–æ—Ä—Ñ–Ω—ã–π –∫–æ–¥ —Ç–æ–ª—å–∫–æ –¥–ª—è shared utilities

**Checklist –ø–µ—Ä–µ–¥ push:**
```bash
npx tsc --noEmit  # TypeScript ‚úÖ
npm run build     # Production build ‚úÖ
git status        # Clean –∏–ª–∏ tracked changes ‚úÖ
git push origin main
```

**–ü—Ä–∞–≤–∏–ª–æ:** –ï—Å–ª–∏ build –Ω–µ –ø—Ä–æ—Ö–æ–¥–∏—Ç ‚Äî –ù–ï –ø—É—à—å. –°–Ω–∞—á–∞–ª–∞ –∏—Å–ø—Ä–∞–≤—å.

---

## üîß Git Workflow

**–ü–æ—Å–ª–µ –ö–ê–ñ–î–û–ì–û –ª–æ–≥–∏—á–µ—Å–∫–æ–≥–æ –∏–∑–º–µ–Ω–µ–Ω–∏—è:**

```bash
git add -A
git commit -m "type: description

Details...

Verified: TypeScript ‚úÖ, Build ‚úÖ"
```

**Conventional Commits format:**
- `feat:` ‚Äî –Ω–æ–≤–∞—è —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å
- `fix:` ‚Äî –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –±–∞–≥–∞
- `refactor:` ‚Äî —Ä–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥ –±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏—è –ø–æ–≤–µ–¥–µ–Ω–∏—è
- `docs:` ‚Äî —Ç–æ–ª—å–∫–æ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è
- `chore:` ‚Äî –∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä–∞, –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏

**Staged commits –ø—Ä–∏ —Ä–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥–µ:**
- –ù–ï "big rewrite" –≤ –æ–¥–Ω–æ–º –∫–æ–º–º–∏—Ç–µ
- –û–¥–∏–Ω –∫–æ–º–º–∏—Ç = –æ–¥–Ω–∞ –∞—Ç–æ–º–∞—Ä–Ω–∞—è —Å—Ç–∞–¥–∏—è —Å –≤–µ—Ä–∏—Ñ–∏–∫–∞—Ü–∏–µ–π
- –ü—Ä–∏–º–µ—Ä: `refactor: consolidate dates (STAGE 1)`

**NO Breaking Changes –±–µ–∑ —è–≤–Ω–æ–≥–æ –∑–∞–ø—Ä–æ—Å–∞:**
- –°–æ—Ö—Ä–∞–Ω—è–π —Å–∏–≥–Ω–∞—Ç—É—Ä—ã —á–µ—Ä–µ–∑ overloads, union —Ç–∏–ø—ã
- –û–±—Ä–∞—Ç–Ω–∞—è —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å –æ–±—è–∑–∞—Ç–µ–ª—å–Ω–∞

---

## üö® TypeScript Strict Mode

**–û–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–π workflow –ø–µ—Ä–µ–¥ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º —Ç–∏–ø–∞:**

```bash
# 1. –ü—Ä–æ–≤–µ—Ä—å —á—Ç–æ —Ç–∏–ø —ç–∫—Å–ø–æ—Ä—Ç–∏—Ä—É–µ—Ç—Å—è
grep "^export.*TypeName" path/to/file.ts

# 2. –ü—Ä–æ–≤–µ—Ä—å –≤–æ–∑–≤—Ä–∞—â–∞–µ–º—ã–π —Ç–∏–ø —Ñ—É–Ω–∫—Ü–∏–∏
grep "functionName.*Promise" path/to/file.ts

# 3. –ù–µ –ø—Ä–µ–¥–ø–æ–ª–∞–≥–∞–π —Ç–∏–ø—ã –ø–æ –Ω–∞–∑–≤–∞–Ω–∏—é —Ñ—É–Ω–∫—Ü–∏–∏
```

**–ü—Ä–∞–≤–∏–ª–∞:**
- –ù–ò–ö–û–ì–î–ê –Ω–µ –∏—Å–ø–æ–ª—å–∑—É–π `any`
- TypeScript strict mode –ª–æ–≤–∏—Ç –æ—à–∏–±–∫–∏ –î–û —Ä–∞–Ω—Ç–∞–π–º–∞
- –ù–µ –æ—Å–ª–∞–±–ª—è–π —Ç–∏–ø—ã –¥–ª—è "–±—ã—Å—Ç—Ä–æ–≥–æ —Ñ–∏–∫—Å–∞"
- –ï—Å–ª–∏ —Ç–∏–ø –Ω–µ —ç–∫—Å–ø–æ—Ä—Ç–∏—Ä—É–µ—Ç—Å—è ‚Äî –æ–Ω –Ω–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç –¥–ª—è –≤–Ω–µ—à–Ω–µ–≥–æ –º–∏—Ä–∞

---

## üì¶ Ownership Map (–∏–∑ ARCHITECTURE.md)

| Topic | Canonical Module | Notes |
|-------|-----------------|-------|
| Date/Time | `lib/utils/dates.ts` | –í—Å–µ —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–∞—Ç |
| Hydration | `lib/utils/hydration.ts` | Batch loading reference data |
| DB Access | `lib/db/client.ts` | `getAdminDb()` wrapper |
| Visibility | `lib/utils/eventVisibility.ts` | Event visibility checks |
| Permissions | `lib/utils/eventPermissions.ts` | Registration eligibility |
| Caching | `lib/cache/staticCache.ts` | Reference data caching |
| UI Formatting | `lib/utils/eventFormatters.ts` | Event price, etc |
| Billing Enforcement | `lib/services/accessControl.ts` | `enforceClubAction()` |

**–ü—Ä–∞–≤–∏–ª–æ:** –ü–µ—Ä–µ–¥ –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ–º –∫–æ–¥–∞ –æ—Ç–∫—Ä–æ–π Ownership Map, –Ω–∞–π–¥–∏ –≤–ª–∞–¥–µ–ª—å—Ü–∞ concern, –∏—Å–ø–æ–ª—å–∑—É–π –¢–û–õ–¨–ö–û –∫–∞–Ω–æ–Ω–∏—á–µ—Å–∫–∏–π –º–æ–¥—É–ª—å.

---

## üîÑ Staged Refactoring Pattern

**–ü—Ä–∏–º–µ—Ä –ø—Ä–∞–≤–∏–ª—å–Ω–æ–≥–æ –ø–æ–¥—Ö–æ–¥–∞:**

```
STAGE 0: Inventory & Doc Foundation
STAGE 1: Date/Time Consolidation
STAGE 2: Supabase Admin DB Client
STAGE 3: Hydration Consolidation
STAGE 4: Visibility & Permissions
STAGE 5: UI Formatters
STAGE 6: Caching Strategy
```

**–ö–∞–∂–¥–∞—è —Å—Ç–∞–¥–∏—è:**
1. –ò–∑–º–µ–Ω–µ–Ω–∏—è –≤ –∫–æ–¥–µ
2. –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ SSOT –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤
3. TypeScript check
4. Production build
5. Git commit
6. Push to Vercel

**–ü—Ä–∞–≤–∏–ª–æ:** –ú–∞–ª–µ–Ω—å–∫–∏–µ –∞—Ç–æ–º–∞—Ä–Ω—ã–µ –∫–æ–º–º–∏—Ç—ã > –æ–¥–∏–Ω –±–æ–ª—å—à–æ–π rewrite.

---

## ‚ö†Ô∏è STOP CONDITIONS

**–ö–æ–≥–¥–∞ –æ—Å—Ç–∞–Ω–æ–≤–∏—Ç—å—Å—è –∏ —Å–ø—Ä–æ—Å–∏—Ç—å:**

1. –ò–∑–º–µ–Ω–µ–Ω–∏–µ –º–æ–∂–µ—Ç –∑–∞—Ç—Ä–æ–Ω—É—Ç—å product behavior
2. –¢—Ä–µ–±—É–µ—Ç—Å—è breaking change –≤ API
3. Vercel build fails
4. SSOT –¥–æ–∫—É–º–µ–Ω—Ç—ã –ø—Ä–æ—Ç–∏–≤–æ—Ä–µ—á–∞—Ç –∫–æ–¥—É
5. –¢—Ä–µ–±—É–µ—Ç—Å—è –¥–æ—Å—Ç—É–ø –∫ env/secrets/CLI

**–ü—Ä–∞–≤–∏–ª–æ:** –õ—É—á—à–µ —Å–ø—Ä–æ—Å–∏—Ç—å, —á–µ–º —Å–¥–µ–ª–∞—Ç—å –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ.

---

## üéØ Definition of Done

–ó–∞–¥–∞—á–∞ —Å—á–∏—Ç–∞–µ—Ç—Å—è –∑–∞–≤–µ—Ä—à–µ–Ω–Ω–æ–π –∫–æ–≥–¥–∞:

- [ ] –ö–æ–¥ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω —Å–æ–≥–ª–∞—Å–Ω–æ SSOT
- [ ] SSOT –¥–æ–∫—É–º–µ–Ω—Ç—ã –æ–±–Ω–æ–≤–ª–µ–Ω—ã (–µ—Å–ª–∏ –Ω—É–∂–Ω–æ)
- [ ] TypeScript strict mode ‚úÖ
- [ ] Production build —É—Å–ø–µ—à–µ–Ω ‚úÖ
- [ ] –ù–µ—Ç linter errors
- [ ] Git commit —Å –æ–ø–∏—Å–∞–Ω–∏–µ–º –∏–∑–º–µ–Ω–µ–Ω–∏–π
- [ ] Push –≤ Vercel (–µ—Å–ª–∏ —Ç—Ä–µ–±—É–µ—Ç—Å—è)

---

**–ü–æ–º–Ω–∏:** –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç —á—Ç–æ–±—ã –°–ù–ò–ó–ò–¢–¨ –∫–æ–≥–Ω–∏—Ç–∏–≤–Ω—É—é –Ω–∞–≥—Ä—É–∑–∫—É, –∞ –Ω–µ —É–≤–µ–ª–∏—á–∏—Ç—å –µ—ë.

**Single Source of Truth = –ú–µ–Ω—å—à–µ –º–µ—Å—Ç –¥–ª—è –ø—Ä–∏–Ω—è—Ç–∏—è —Ä–µ—à–µ–Ω–∏–π = –ú–µ–Ω—å—à–µ –æ—à–∏–±–æ–∫.**
