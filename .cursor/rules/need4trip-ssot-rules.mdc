---
alwaysApply: true
---

# Need4Trip - SSOT Rules (Single Source of Truth)

**Last Updated:** 1 —è–Ω–≤–∞—Ä—è 2026  
**Status:** Production Ready ‚úÖ

---

## üéØ –ì–õ–ê–í–ù–´–ô –ü–†–ò–ù–¶–ò–ü

> **–í–°–ï —Ñ–∞–π–ª—ã `SSOT_*.md` –≤ –ø–∞–ø–∫–µ `docs/ssot/` —è–≤–ª—è—é—Ç—Å—è –∏—Å—Ç–æ—á–Ω–∏–∫–∞–º–∏ –∏—Å—Ç–∏–Ω—ã:**
>
> | # | –§–∞–π–ª | –û–±–ª–∞—Å—Ç—å |
> |---|------|---------|
> | 1 | `SSOT_ARCHITECTURE.md` | –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞, –ø–∞—Ç—Ç–µ—Ä–Ω—ã, ownership map |
> | 2 | `SSOT_DATABASE.md` | —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –ë–î, —Ç–∞–±–ª–∏—Ü—ã, –∏–Ω–¥–µ–∫—Å—ã, RLS |
> | 3 | `SSOT_BILLING_SYSTEM_ANALYSIS.md` | –±–∏–ª–ª–∏–Ω–≥, —Ç–∞—Ä–∏—Ñ—ã, –ª–∏–º–∏—Ç—ã |
> | 4 | `SSOT_TESTING.md` | —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ, —Ç–µ—Å—Ç-–∫–µ–π—Å—ã, —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã |
> | 5 | `SSOT_DESIGN_SYSTEM.md` | UI/UX, –º–æ–¥–∞–ª–∫–∏, —Ü–≤–µ—Ç–∞, –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã |
> | 6 | `SSOT_CLUBS_EVENTS_ACCESS.md` | club & event access rules |
> | 7 | `SSOT_API.md` | API endpoints, auth, rate limits |
> | 8 | `SSOT_CLUBS_DOMAIN.md` | clubs domain model, cities, management |
>
> **–ò–°–ö–õ–Æ–ß–ï–ù–ò–ï:** –§–∞–π–ª—ã –≤ `docs/ssot/archive/` ‚Äî —ç—Ç–æ NON-NORMATIVE –∞—Ä—Ö–∏–≤–Ω—ã–µ –¥–æ–∫—É–º–µ–Ω—Ç—ã (–∏—Å—Ç–æ—Ä–∏—è, –ø—Ä–∏–º–µ—Ä—ã –∫–æ–¥–∞). –û–Ω–∏ –ù–ï —è–≤–ª—è—é—Ç—Å—è –∏—Å—Ç–æ—á–Ω–∏–∫–∞–º–∏ –∏—Å—Ç–∏–Ω—ã.
>
> **–ü—Ä–∞–≤–∏–ª–æ**: SSOT = –ª—é–±–æ–π `SSOT_*.md` –≤ `docs/ssot/` (–∫—Ä–æ–º–µ `archive/`)

---

## üîÑ –°–ò–ù–•–†–û–ù–ò–ó–ê–¶–ò–Ø MEMORY ‚Üî RULES FILES

**–ö–†–ò–¢–ò–ß–ù–û:** Memory –ø—Ä–∞–≤–∏–ª–∞ (–≤ –±–∞–∑–µ Cursor) –∏ Rules —Ñ–∞–π–ª—ã (`.cursor/rules/*.mdc`) –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å –í–°–ï–ì–î–ê —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä–æ–≤–∞–Ω—ã.

### –ü–û–°–õ–ï —Å–æ–∑–¥–∞–Ω–∏—è/–æ–±–Ω–æ–≤–ª–µ–Ω–∏—è Memory –ø—Ä–∞–≤–∏–ª–∞:
1. ‚úÖ –ü—Ä–æ–≤–µ—Ä—å —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–∏–π rules —Ñ–∞–π–ª
2. ‚úÖ –û–±–Ω–æ–≤–∏ —Ñ–∞–π–ª —Å –Ω–æ–≤–æ–π –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–µ–π –∏–∑ Memory
3. ‚úÖ –ö–æ–º–º–∏—Ç—å –æ–±–Ω–æ–≤–ª–µ–Ω–Ω—ã–π rules —Ñ–∞–π–ª
4. ‚úÖ –í commit message: "sync Memory ‚Üí Rules"

### –ü–û–°–õ–ï –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è rules —Ñ–∞–π–ª–∞:
1. ‚úÖ –ü—Ä–æ–≤–µ—Ä—å —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–∏–µ Memory –ø—Ä–∞–≤–∏–ª–∞
2. ‚úÖ –û–±–Ω–æ–≤–∏ Memory —á–µ—Ä–µ–∑ `update_memory` –µ—Å–ª–∏ –Ω—É–∂–Ω–æ
3. ‚úÖ –£–±–µ–¥–∏—Å—å —á—Ç–æ –Ω–µ—Ç —Ä–∞–∑–Ω–æ–≥–ª–∞—Å–∏–π

**Mapping:**
- SSOT_ARCHITECTURE.md ‚Üí `need4trip-ssot-rules.mdc` (—Å–µ–∫—Ü–∏—è ARCHITECTURE)
- SSOT_DATABASE.md ‚Üí `need4trip-ssot-rules.mdc` (—Å–µ–∫—Ü–∏—è DATABASE)
- SSOT_BILLING_SYSTEM_ANALYSIS.md ‚Üí `need4trip-ssot-rules.mdc` (—Å–µ–∫—Ü–∏—è BILLING)
- SSOT_TESTING.md ‚Üí `need4trip-ssot-rules.mdc` (—Å–µ–∫—Ü–∏—è TESTING)
- SSOT_DESIGN_SYSTEM.md ‚Üí `need4trip-ssot-rules.mdc` (—Å–µ–∫—Ü–∏—è DESIGN)
- SSOT_CLUBS_EVENTS_ACCESS.md ‚Üí `need4trip-ssot-rules.mdc` (—Å–µ–∫—Ü–∏—è CLUBS_EVENTS)
- SSOT_CLUBS_DOMAIN.md ‚Üí `need4trip-ssot-rules.mdc` (—Å–µ–∫—Ü–∏—è CLUBS_DOMAIN)
- SSOT_API.md ‚Üí `need4trip-ssot-rules.mdc` (—Å–µ–∫—Ü–∏—è API)

**–ü—Ä–∏—á–∏–Ω–∞:** Rules —Ñ–∞–π–ª—ã –≤–∏–¥–Ω—ã –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é, Memory ‚Äî —Ç–æ–ª—å–∫–æ AI. –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è = –∫–æ–Ω—Å–∏—Å—Ç–µ–Ω—Ç–Ω–æ—Å—Ç—å.

---

## üìã –û–ë–Ø–ó–ê–¢–ï–õ–¨–ù–´–ô WORKFLOW

### –ü–ï–†–ï–î –ª—é–±—ã–º –∏–∑–º–µ–Ω–µ–Ω–∏–µ–º:

1. **–û–ø—Ä–µ–¥–µ–ª–∏ –æ–±–ª–∞—Å—Ç—å:**
   - –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞/–ø–∞—Ç—Ç–µ—Ä–Ω—ã ‚Üí —á–∏—Ç–∞–π `docs/ssot/SSOT_ARCHITECTURE.md`
   - –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö ‚Üí —á–∏—Ç–∞–π `docs/ssot/SSOT_DATABASE.md`
   - –ë–∏–ª–ª–∏–Ω–≥/–ª–∏–º–∏—Ç—ã ‚Üí —á–∏—Ç–∞–π `docs/ssot/SSOT_BILLING_SYSTEM_ANALYSIS.md`
   - –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ ‚Üí —á–∏—Ç–∞–π `docs/ssot/SSOT_TESTING.md`
   - UI/UX/–¥–∏–∑–∞–π–Ω ‚Üí —á–∏—Ç–∞–π `docs/ssot/SSOT_DESIGN_SYSTEM.md`
   - Club/Event access ‚Üí —á–∏—Ç–∞–π `docs/ssot/SSOT_CLUBS_EVENTS_ACCESS.md`
   - Clubs domain (–≥–æ—Ä–æ–¥–∞, —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ) ‚Üí —á–∏—Ç–∞–π `docs/ssot/SSOT_CLUBS_DOMAIN.md`
   - API endpoints ‚Üí —á–∏—Ç–∞–π `docs/ssot/SSOT_API.md`

2. **–ò–∑—É—á–∏ SSOT:**
   - –ù–∞–π–¥–∏ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–∏–π —Ä–∞–∑–¥–µ–ª
   - –ü–æ–π–º–∏ —Ç–µ–∫—É—â–∏–µ –ø—Ä–∞–≤–∏–ª–∞ –∏ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è
   - –ü—Ä–æ–≤–µ—Ä—å ownership map

3. **–°–ø–ª–∞–Ω–∏—Ä—É–π –∏–∑–º–µ–Ω–µ–Ω–∏—è:**
   - –°–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—Ç –ª–∏ –æ–Ω–∏ –ø—Ä–∏–Ω—Ü–∏–ø–∞–º SSOT?
   - –ù–µ –Ω–∞—Ä—É—à–∞—é—Ç –ª–∏ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ –∫–æ–Ω—Ç—Ä–∞–∫—Ç—ã?
   - –û–±—Ä–∞—Ç–Ω–∞—è —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å –≥–∞—Ä–∞–Ω—Ç–∏—Ä–æ–≤–∞–Ω–∞?

### –ü–û–°–õ–ï –∏–∑–º–µ–Ω–µ–Ω–∏—è:

1. **–û–±–Ω–æ–≤–∏ SSOT:**
   - –°–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–∏–π —Ñ–∞–π–ª –≤ `docs/ssot/SSOT_*.md`
   
2. **–ö–æ–º–º–∏—Ç:**
   - –ö–æ–¥ + –æ–±–Ω–æ–≤–ª–µ–Ω–Ω—ã–π SSOT –≤ –û–î–ù–û–ú –∫–æ–º–º–∏—Ç–µ
   - –ö–æ–º–º–∏—Ç message —É–∫–∞–∑—ã–≤–∞–µ—Ç —á—Ç–æ –æ–±–Ω–æ–≤–ª–µ–Ω SSOT

3. **Verification:**
   - `npx tsc --noEmit` ‚úÖ
   - `npm run build` ‚úÖ
   - SSOT –æ—Ç—Ä–∞–∂–∞–µ—Ç –∞–∫—Ç—É–∞–ª—å–Ω–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ ‚úÖ

---

## üèóÔ∏è SSOT_ARCHITECTURE.md

**–ß—Ç–æ —Å–æ–¥–µ—Ä–∂–∏—Ç:**
- Module ownership map (–∫—Ç–æ –æ—Ç–≤–µ—á–∞–µ—Ç –∑–∞ —á—Ç–æ)
- Data access patterns (Repos ‚Üí Services ‚Üí API)
- Runtime boundaries (Server vs Client, Edge vs Node)
- Caching strategy (StaticCache –¥–ª—è reference data)
- Auth & currentUser rules
- Type safety contracts

**–ö–ª—é—á–µ–≤—ã–µ –ø–∞—Ç—Ç–µ—Ä–Ω—ã:**

```typescript
// ‚úÖ DB Access
const db = getAdminDb();

// ‚úÖ Date/Time
import { formatDateTime, parseDateTime } from '@/lib/utils/dates';

// ‚úÖ Hydration
const events = await hydrateCities(rawEvents);

// ‚úÖ Visibility
const canView = await canViewEvent(event, currentUser);

// ‚úÖ Permissions
const canRegister = await canRegisterForEvent(event, currentUser);

// ‚úÖ Caching
const cache = new StaticCache<T>({ ttl, name }, loader, keyExtractor);
```

**–ó–ê–ü–†–ï–©–ï–ù–û:**
- ‚ùå –î—É–±–ª–∏—Ä–æ–≤–∞—Ç—å –ª–æ–≥–∏–∫—É (–≤—Å–µ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑—É–π canonical –º–æ–¥—É–ª—å)
- ‚ùå UI ‚Üí Repository –Ω–∞–ø—Ä—è–º—É—é (—Ç–æ–ª—å–∫–æ —á–µ—Ä–µ–∑ Services)
- ‚ùå Server-only –∫–æ–¥ –≤ client components

**–ü—Ä–∞–≤–∏–ª–æ:** –ü–µ—Ä–µ–¥ –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ–º –∫–æ–¥–∞ –æ—Ç–∫—Ä–æ–π Ownership Map, –Ω–∞–π–¥–∏ –≤–ª–∞–¥–µ–ª—å—Ü–∞ concern, –∏—Å–ø–æ–ª—å–∑—É–π –¢–û–õ–¨–ö–û –∫–∞–Ω–æ–Ω–∏—á–µ—Å–∫–∏–π –º–æ–¥—É–ª—å.

---

## üóÑÔ∏è SSOT_DATABASE.md

**–ß—Ç–æ —Å–æ–¥–µ—Ä–∂–∏—Ç:**
- 23 —Ç–∞–±–ª–∏—Ü—ã —Å –ø–æ–ª–Ω—ã–º–∏ CREATE TABLE —Å—Ö–µ–º–∞–º–∏
- Performance indexes (compound, covering, partial)
- RLS policies summary
- Database functions & triggers
- Migration history (81+ –º–∏–≥—Ä–∞—Ü–∏–π)

**SQL –ú–∏–≥—Ä–∞—Ü–∏–∏ (–°–¢–†–û–ì–û!):**

```bash
# –§–æ—Ä–º–∞—Ç –∏–º–µ–Ω–∏ (–û–ë–Ø–ó–ê–¢–ï–õ–¨–ù–û —Å timestamp):
supabase/migrations/YYYYMMDD_description.sql
```

**Workflow:**
1. –ß–∏—Ç–∞–π `docs/ssot/SSOT_DATABASE.md` –ø–µ—Ä–µ–¥ –∏–∑–º–µ–Ω–µ–Ω–∏–µ–º
2. –°–æ–∑–¥–∞–π –º–∏–≥—Ä–∞—Ü–∏—é —Å timestamp
3. –ü—Ä–∏–º–µ–Ω–∏ –º–∏–≥—Ä–∞—Ü–∏—é –≤ Supabase
4. –û–±–Ω–æ–≤–∏ SSOT_DATABASE.md —Å –Ω–æ–≤–æ–π —Å—Ç—Ä—É–∫—Ç—É—Ä–æ–π
5. –ö–æ–º–º–∏—Ç—å –º–∏–≥—Ä–∞—Ü–∏—é + SSOT –≤–º–µ—Å—Ç–µ

**–ó–ê–ü–†–ï–©–ï–ù–û:**
- ‚ùå SQL —Ñ–∞–π–ª—ã –±–µ–∑ timestamp –≤ –Ω–∞–∑–≤–∞–Ω–∏–∏
- ‚ùå SQL —Ñ–∞–π–ª—ã –≤ –∫–æ—Ä–Ω–µ –ø—Ä–æ–µ–∫—Ç–∞
- ‚ùå –í—Ä–µ–º–µ–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã —Ç–∏–ø–∞ `.temp_migrations/`
- ‚ùå –ò–∑–º–µ–Ω–µ–Ω–∏–µ —É–∂–µ –ø—Ä–∏–º–µ–Ω–µ–Ω–Ω—ã—Ö –º–∏–≥—Ä–∞—Ü–∏–π
- ‚ùå –ü—Ä—è–º—ã–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è –≤ –ë–î –±–µ–∑ –º–∏–≥—Ä–∞—Ü–∏–∏

---

## üí≥ SSOT_BILLING_SYSTEM_ANALYSIS.md

**–ß—Ç–æ —Å–æ–¥–µ—Ä–∂–∏—Ç:**
- –¢–∞—Ä–∏—Ñ—ã (free, club_50, club_500, club_unlimited)
- –õ–∏–º–∏—Ç—ã –¥–ª—è –∫–∞–∂–¥–æ–≥–æ —Ç–∞—Ä–∏—Ñ–∞
- Enforcement –ª–æ–≥–∏–∫–∞ (enforceClubAction)
- PaywallError —Å—Ç—Ä—É–∫—Ç—É—Ä–∞
- Frontend –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è (PaywallModal)

**–ö–ª—é—á–µ–≤—ã–µ –ø—Ä–∏–Ω—Ü–∏–ø—ã:**

1. **Frontend –ù–ï —Ä–µ—à–∞–µ—Ç –ª–∏–º–∏—Ç—ã:**
   - –§—Ä–æ–Ω—Ç —Ç–æ–ª—å–∫–æ –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç UI
   - –†–µ–∞–≥–∏—Ä—É–µ—Ç –Ω–∞ 402 –æ—Ç backend
   - –ò—Å–ø–æ–ª—å–∑—É–µ—Ç `PaywallModal.tsx` (—Ç–∏–ø–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–π)

2. **Backend ‚Äî –µ–¥–∏–Ω—Å—Ç–≤–µ–Ω–Ω—ã–π –∏—Å—Ç–æ—á–Ω–∏–∫ –∏—Å—Ç–∏–Ω—ã:**
   - `enforceClubAction()` –≤ `src/lib/services/accessControl.ts`
   - Throws `PaywallError` (402) –µ—Å–ª–∏ –ª–∏–º–∏—Ç –ø—Ä–µ–≤—ã—à–µ–Ω

**–ü—Ä–∏–º–µ—Ä:**

```typescript
// Backend
await enforceClubAction({
  clubId: event.clubId,
  action: 'CREATE_EVENT_WITH_PARTICIPANTS',
  context: { eventParticipantsCount: 100 }
});

// Frontend
const { showPaywall, PaywallModalComponent } = usePaywall();
if (err.response?.status === 402) {
  showPaywall(err.response.data.error.details);
}
```

---

## üß™ SSOT_TESTING.md

**–ß—Ç–æ —Å–æ–¥–µ—Ä–∂–∏—Ç:**
- 53 automated tests (43 integration + 2 skipped + 8 E2E TODO)
- QA-1 to QA-8: Core billing v4 tests
- QA-9 to QA-15: Event enforcement (Production Bug Fix 2024-12-26)
- QA-16 to QA-45: Extended coverage
- QA-46 to QA-53: E2E Playwright tests (TODO)

**–ö–æ–º–∞–Ω–¥—ã:**
```bash
npm test                    # –í—Å–µ integration tests
npm test -- billing.v4      # Core billing tests  
npm run test:e2e           # E2E Playwright tests
```

**–ü—Ä–∞–≤–∏–ª–æ:** –ü–µ—Ä–µ–¥ –∏–∑–º–µ–Ω–µ–Ω–∏–µ–º —Ç–µ—Å—Ç–æ–≤ —á–∏—Ç–∞–π `docs/ssot/SSOT_TESTING.md`. –ü–æ—Å–ª–µ –∏–∑–º–µ–Ω–µ–Ω–∏–π –æ–±–Ω–æ–≤–ª—è–π SSOT + –∫–æ–º–º–∏—Ç—å –≤–º–µ—Å—Ç–µ.

---

## üé® SSOT_DESIGN_SYSTEM.md

**–ß—Ç–æ —Å–æ–¥–µ—Ä–∂–∏—Ç:**
- –ú–æ–¥–∞–ª—å–Ω—ã–µ –æ–∫–Ω–∞ (Dialog/AlertDialog) ‚Äî production-ready –ø–∞—Ç—Ç–µ—Ä–Ω
- –¶–≤–µ—Ç–æ–≤–∞—è —Å–∏—Å—Ç–µ–º–∞ (CSS variables)
- –¢–∏–ø–æ–≥—Ä–∞—Ñ–∏–∫–∞ (Inter font)
- Buttons, Cards, Badges
- –ê–Ω–∏–º–∞—Ü–∏–∏ (fade/zoom, –ë–ï–ó translateY –∫–æ–Ω—Ñ–ª–∏–∫—Ç–æ–≤)
- –ê–¥–∞–ø—Ç–∏–≤–Ω–æ—Å—Ç—å (mobile first)

**–ú–æ–¥–∞–ª–∫–∏ (–ö–†–ò–¢–ò–ß–ù–û!):**

```tsx
<Dialog>
  <DialogContent className="sm:max-w-lg">
    <DialogHeader>
      <DialogTitle>Title</DialogTitle>
    </DialogHeader>
    <DialogBody className="space-y-4">
      {/* Scrollable content */}
    </DialogBody>
    <DialogFooter>
      <Button>Confirm</Button>
    </DialogFooter>
  </DialogContent>
</Dialog>
```

**–ê–Ω–∞—Ç–æ–º–∏—è:**
- DialogContent: `flex flex-col max-h-[90vh]`
- DialogHeader: fixed (border-b)
- DialogBody: scrollable (`flex-1 overflow-y-auto`)
- DialogFooter: fixed (border-t)

**–¶–≤–µ—Ç–∞:**
```tsx
// ‚úÖ –ò—Å–ø–æ–ª—å–∑—É–π CSS variables
<Button className="bg-[var(--color-primary)]">
```

**–ü—Ä–∞–≤–∏–ª–æ:** –í–°–ï–ì–î–ê —á–∏—Ç–∞–π SSOT_DESIGN_SYSTEM.md –ø–µ—Ä–µ–¥ UI –∏–∑–º–µ–Ω–µ–Ω–∏—è–º–∏.

---

## üîê SSOT_CLUBS_EVENTS_ACCESS.md

**–ß—Ç–æ —Å–æ–¥–µ—Ä–∂–∏—Ç:**
- Club roles (owner, admin, member, pending)
- Event clubness (club_id IS NOT NULL)
- Paid modes (personal credit vs club subscription)
- UI rules (checkbox + single club dropdown)
- Backend authorization rules
- Canonical matrices for permissions

**–ö–ª—é—á–µ–≤—ã–µ –ø—Ä–∞–≤–∏–ª–∞:**
- Club event publish (paid): ONLY owner
- Club ID immutable after creation
- No mixing personal + club billing
- Club selection: Section 0 in EventForm

**–ü—Ä–∞–≤–∏–ª–æ:** –ß–∏—Ç–∞–π SSOT_CLUBS_EVENTS_ACCESS.md –¥–ª—è –ª—é–±—ã—Ö –∏–∑–º–µ–Ω–µ–Ω–∏–π –≤ club/event access.

---

## üè¢ SSOT_CLUBS_DOMAIN.md

**–ß—Ç–æ —Å–æ–¥–µ—Ä–∂–∏—Ç:**
- Clubs domain model (—Å—É—â–Ω–æ—Å—Ç–∏, —Å–≤—è–∑–∏)
- City assignments (multi-city clubs)
- Club management operations
- Membership lifecycle

**–ö–ª—é—á–µ–≤—ã–µ –ø—Ä–∞–≤–∏–ª–∞:**
- Club –º–æ–∂–µ—Ç –±—ã—Ç—å –ø—Ä–∏–≤—è–∑–∞–Ω –∫ –Ω–µ—Å–∫–æ–ª—å–∫–∏–º –≥–æ—Ä–æ–¥–∞–º
- Club owner ‚Äî –µ–¥–∏–Ω—Å—Ç–≤–µ–Ω–Ω—ã–π —Å billing authority
- Membership states: owner, admin, member, pending

**–ü—Ä–∞–≤–∏–ª–æ:** –ß–∏—Ç–∞–π SSOT_CLUBS_DOMAIN.md –¥–ª—è –ª—é–±—ã—Ö –∏–∑–º–µ–Ω–µ–Ω–∏–π –≤ clubs domain.

---

## üåê SSOT_API.md

**–ß—Ç–æ —Å–æ–¥–µ—Ä–∂–∏—Ç:**
- –ü–æ–ª–Ω–∞—è –∏–Ω–≤–µ–Ω—Ç–∞—Ä–∏–∑–∞—Ü–∏—è –≤—Å–µ—Ö 50 API endpoints (API-001 to API-050)
- –ì–ª–æ–±–∞–ª—å–Ω—ã–µ –∫–æ–Ω–≤–µ–Ω—Ü–∏–∏ (auth, authorization, rate limiting, billing)
- Self-audit —Å coverage check
- Security sanity check

**–ö–ª—é—á–µ–≤—ã–µ –ø–∞—Ç—Ç–µ—Ä–Ω—ã:**

```typescript
// ‚úÖ Auth (protected)
const user = await getCurrentUserFromMiddleware(request);
if (!user) throw new UnauthorizedError();

// ‚úÖ Billing enforcement
await enforceClubAction({
  clubId: string,
  action: BillingActionCode,
  context?: { ... }
});

// ‚úÖ Response format
return respondSuccess({ data }, message?, status?, headers?);
return respondError(error);
```

**–ü—Ä–∞–≤–∏–ª–æ:** –ù–æ–≤—ã–π endpoint MUST be documented –≤ SSOT_API.md –≤ —Ç–æ–º –∂–µ PR.

---

## üìÅ Session Documents (–í—Ä–µ–º–µ–Ω–Ω—ã–µ)

**–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ:** –ê–Ω–∞–ª–∏—Ç–∏—á–µ—Å–∫–∏–µ –¥–æ–∫—É–º–µ–Ω—Ç—ã –¥–ª—è –±–æ–ª—å—à–∏—Ö –∑–∞–¥–∞—á

**–°—Ç—Ä—É–∫—Ç—É—Ä–∞:**
```
docs/sessions/
‚îú‚îÄ‚îÄ YYYY-MM-DD-–Ω–∞–∑–≤–∞–Ω–∏–µ/
‚îÇ   ‚îú‚îÄ‚îÄ analysis.md
‚îÇ   ‚îú‚îÄ‚îÄ implementation.md
‚îÇ   ‚îî‚îÄ‚îÄ complete.md
‚îî‚îÄ‚îÄ README.md
```

**–ü—Ä–∞–≤–∏–ª–∞:**
- ‚úÖ –°–æ–∑–¥–∞–≤–∞–π session –¥–ª—è –±–æ–ª—å—à–∏—Ö –∑–∞–¥–∞—á
- ‚úÖ –ü–µ—Ä–µ–Ω–æ—Å–∏ insights –≤ SSOT –ø–æ—Å–ª–µ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è
- ‚úÖ –£–¥–∞–ª—è–π —Å—Ç–∞—Ä—ã–µ sessions (>30 –¥–Ω–µ–π)
- ‚ùå –ù–ï –∏—Å–ø–æ–ª—å–∑—É–π sessions –∫–∞–∫ –∏—Å—Ç–æ—á–Ω–∏–∫ –∏—Å—Ç–∏–Ω—ã

---

## ‚úÖ Vercel Compatibility

**Runtime boundaries:**

```typescript
// ‚úÖ Server-only utilities
import { getAdminDb } from '@/lib/db/client'; // OK –≤ API routes

// ‚ùå –ù–ò–ö–û–ì–î–ê –≤ client components
'use client';
import { supabaseAdmin } from '@/lib/db/client'; // ‚ùå –û–®–ò–ë–ö–ê –ë–ò–õ–î–ê
```

**Checklist –ø–µ—Ä–µ–¥ push:**
```bash
npx tsc --noEmit  # TypeScript ‚úÖ
npm run build     # Production build ‚úÖ
git push origin main
```

---

## üîß Git Workflow

**–ü–æ—Å–ª–µ –ö–ê–ñ–î–û–ì–û –ª–æ–≥–∏—á–µ—Å–∫–æ–≥–æ –∏–∑–º–µ–Ω–µ–Ω–∏—è:**

```bash
git add -A
git commit -m "type: description

Details...

Verified: TypeScript ‚úÖ, Build ‚úÖ"
```

**Conventional Commits:**
- `feat:` ‚Äî –Ω–æ–≤–∞—è —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å
- `fix:` ‚Äî –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –±–∞–≥–∞
- `refactor:` ‚Äî —Ä–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥ –±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏—è –ø–æ–≤–µ–¥–µ–Ω–∏—è
- `docs:` ‚Äî —Ç–æ–ª—å–∫–æ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è
- `chore:` ‚Äî –∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä–∞, –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏

**NO Breaking Changes –±–µ–∑ —è–≤–Ω–æ–≥–æ –∑–∞–ø—Ä–æ—Å–∞.**

---

## üö® TypeScript Strict Mode

**–ü—Ä–∞–≤–∏–ª–∞:**
- –ù–ò–ö–û–ì–î–ê –Ω–µ –∏—Å–ø–æ–ª—å–∑—É–π `any`
- TypeScript strict mode –ª–æ–≤–∏—Ç –æ—à–∏–±–∫–∏ –î–û —Ä–∞–Ω—Ç–∞–π–º–∞
- –ù–µ –æ—Å–ª–∞–±–ª—è–π —Ç–∏–ø—ã –¥–ª—è "–±—ã—Å—Ç—Ä–æ–≥–æ —Ñ–∏–∫—Å–∞"
- –ï—Å–ª–∏ —Ç–∏–ø –Ω–µ —ç–∫—Å–ø–æ—Ä—Ç–∏—Ä—É–µ—Ç—Å—è ‚Äî –æ–Ω –Ω–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç –¥–ª—è –≤–Ω–µ—à–Ω–µ–≥–æ –º–∏—Ä–∞

---

## üì¶ Ownership Map

| Topic | Canonical Module |
|-------|------------------|
| Date/Time | `lib/utils/dates.ts` |
| Hydration | `lib/utils/hydration.ts` |
| DB Access | `lib/db/client.ts` |
| Visibility | `lib/utils/eventVisibility.ts` |
| Permissions | `lib/utils/eventPermissions.ts` |
| Caching | `lib/cache/staticCache.ts` |
| UI Formatting | `lib/utils/eventFormatters.ts` |
| Billing Enforcement | `lib/services/accessControl.ts` |

**–ü—Ä–∞–≤–∏–ª–æ:** –ü–µ—Ä–µ–¥ –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ–º –∫–æ–¥–∞ –æ—Ç–∫—Ä–æ–π Ownership Map –≤ SSOT_ARCHITECTURE.md.

---

## ‚ö†Ô∏è STOP CONDITIONS

**–ö–æ–≥–¥–∞ –æ—Å—Ç–∞–Ω–æ–≤–∏—Ç—å—Å—è –∏ —Å–ø—Ä–æ—Å–∏—Ç—å:**

1. –ò–∑–º–µ–Ω–µ–Ω–∏–µ –º–æ–∂–µ—Ç –∑–∞—Ç—Ä–æ–Ω—É—Ç—å product behavior
2. –¢—Ä–µ–±—É–µ—Ç—Å—è breaking change –≤ API
3. Vercel build fails
4. SSOT –¥–æ–∫—É–º–µ–Ω—Ç—ã –ø—Ä–æ—Ç–∏–≤–æ—Ä–µ—á–∞—Ç –∫–æ–¥—É
5. –¢—Ä–µ–±—É–µ—Ç—Å—è –¥–æ—Å—Ç—É–ø –∫ env/secrets/CLI

---

## üéØ Definition of Done

–ó–∞–¥–∞—á–∞ —Å—á–∏—Ç–∞–µ—Ç—Å—è –∑–∞–≤–µ—Ä—à–µ–Ω–Ω–æ–π –∫–æ–≥–¥–∞:

- [ ] –ö–æ–¥ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω —Å–æ–≥–ª–∞—Å–Ω–æ SSOT
- [ ] SSOT –¥–æ–∫—É–º–µ–Ω—Ç—ã –æ–±–Ω–æ–≤–ª–µ–Ω—ã (–µ—Å–ª–∏ –Ω—É–∂–Ω–æ)
- [ ] TypeScript strict mode ‚úÖ
- [ ] Production build —É—Å–ø–µ—à–µ–Ω ‚úÖ
- [ ] –ù–µ—Ç linter errors
- [ ] Git commit —Å –æ–ø–∏—Å–∞–Ω–∏–µ–º –∏–∑–º–µ–Ω–µ–Ω–∏–π
- [ ] Push –≤ Vercel (–µ—Å–ª–∏ —Ç—Ä–µ–±—É–µ—Ç—Å—è)

---

**–ü–æ–º–Ω–∏:** –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç —á—Ç–æ–±—ã –°–ù–ò–ó–ò–¢–¨ –∫–æ–≥–Ω–∏—Ç–∏–≤–Ω—É—é –Ω–∞–≥—Ä—É–∑–∫—É.

**Single Source of Truth = –ú–µ–Ω—å—à–µ –º–µ—Å—Ç –¥–ª—è –ø—Ä–∏–Ω—è—Ç–∏—è —Ä–µ—à–µ–Ω–∏–π = –ú–µ–Ω—å—à–µ –æ—à–∏–±–æ–∫.**
