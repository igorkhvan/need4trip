# üîç –ê–Ω–∞–ª–∏–∑ –∫–æ–¥–æ–≤–æ–π –±–∞–∑—ã Need4Trip

**–î–∞—Ç–∞:** 2024-12-13  
**–û–±—â–∏–π –æ–±—ä–µ–º –∫–æ–¥–∞:** ~7,776 —Å—Ç—Ä–æ–∫ TypeScript/TSX  
**–°—Ç–∞—Ç—É—Å:** –ü–æ—Å–ª–µ –Ω–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏–∏ –ë–î –∏ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏ —Å–∏—Å—Ç–µ–º—ã –∫–ª—É–±–æ–≤

---

## üìä –°–≤–æ–¥–∫–∞ –ø–æ –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏–º –ø—Ä–æ–±–ª–µ–º–∞–º

### üî¥ **–ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –ø—Ä–æ–±–ª–µ–º—ã (—Ç—Ä–µ–±—É—é—Ç –Ω–µ–º–µ–¥–ª–µ–Ω–Ω–æ–≥–æ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è)**

#### 1. **–î—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ —Ç–∏–ø–∞ Params –≤ API route** 
**–§–∞–π–ª:** `src/app/api/events/[id]/route.ts:5`

```typescript
type Params = { params: Promise<{ id: string }> } | { params: Promise<{ id: string }> };
```

**–ü—Ä–æ–±–ª–µ–º–∞:** –ë–µ—Å—Å–º—ã—Å–ª–µ–Ω–Ω—ã–π union `A | A`  
**–†–µ—à–µ–Ω–∏–µ:** –£–ø—Ä–æ—Å—Ç–∏—Ç—å –¥–æ `type Params = { params: Promise<{ id: string }> };`

---

#### 2. **–û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ hydration –≥–æ—Ä–æ–¥–∞ –¥–ª—è –∫–ª—É–±–æ–≤**
**–§–∞–π–ª—ã:** `src/lib/services/clubs.ts`

**–ü—Ä–æ–±–ª–µ–º–∞:** 
- Events service –∏–º–µ–µ—Ç batch hydration –≥–æ—Ä–æ–¥–æ–≤ (—Å—Ç—Ä–æ–∫–∏ 119-147)
- Clubs service –ù–ï –∏–º–µ–µ—Ç hydration –≥–æ—Ä–æ–¥–æ–≤
- –ü—Ä–∏ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–∏ –∫–ª—É–±–æ–≤ `club.city` –±—É–¥–µ—Ç `undefined`

**–†–µ—à–µ–Ω–∏–µ:** –î–æ–±–∞–≤–∏—Ç—å –∞–Ω–∞–ª–æ–≥–∏—á–Ω—É—é –ª–æ–≥–∏–∫—É –≤ `listClubs()` –∏ `searchClubs()`:

```typescript
// –í clubs.ts –ø–æ—Å–ª–µ –∏–º–ø–æ—Ä—Ç–æ–≤
import { getCitiesByIds } from "@/lib/db/cityRepo";

// –í —Ñ—É–Ω–∫—Ü–∏—è—Ö listClubs() –∏ searchClubs()
const cityIds = clubs.map(c => c.cityId).filter((id): id is string => id !== null);
const uniqueCityIds = Array.from(new Set(cityIds));
let citiesMap = new Map<string, any>();
if (uniqueCityIds.length > 0) {
  citiesMap = await getCitiesByIds(uniqueCityIds);
}

return clubs.map(club => ({
  ...mapDbClubToDomain(club),
  city: club.city_id ? citiesMap.get(club.city_id) : null,
}));
```

---

#### 3. **–û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ hydration –≤–∞–ª—é—Ç—ã –¥–ª—è —Å–æ–±—ã—Ç–∏–π**
**–§–∞–π–ª:** `src/lib/services/events.ts`

**–ü—Ä–æ–±–ª–µ–º–∞:** 
- Events –∏–º–µ—é—Ç `currencyCode`, –Ω–æ –Ω–µ hydrated `currency` –æ–±—ä–µ–∫—Ç
- UI –∏—Å–ø–æ–ª—å–∑—É–µ—Ç `event.currency?.symbol ?? event.currencyCode`
- –ú–æ–∂–Ω–æ –æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞—Ç—å —Å batch loading

**–†–µ—à–µ–Ω–∏–µ:** –î–æ–±–∞–≤–∏—Ç—å batch loading –≤–∞–ª—é—Ç –∞–Ω–∞–ª–æ–≥–∏—á–Ω–æ –≥–æ—Ä–æ–¥–∞–º

---

### üü° **–°—Ä–µ–¥–Ω–∏–µ –ø—Ä–æ–±–ª–µ–º—ã (–∂–µ–ª–∞—Ç–µ–ª—å–Ω–æ –∏—Å–ø—Ä–∞–≤–∏—Ç—å)**

#### 4. **–ß—Ä–µ–∑–º–µ—Ä–Ω–æ–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ `as any` (46 —Å–ª—É—á–∞–µ–≤)**

**–†–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ:**
- `src/lib/db/clubMemberRepo.ts`: 12 —Å–ª—É—á–∞–µ–≤
- `src/lib/db/subscriptionRepo.ts`: 8 —Å–ª—É—á–∞–µ–≤
- `src/lib/db/clubRepo.ts`: 9 —Å–ª—É—á–∞–µ–≤
- `src/lib/db/cityRepo.ts`: 6 —Å–ª—É—á–∞–µ–≤
- `src/lib/db/currencyRepo.ts`: 4 —Å–ª—É—á–∞—è
- `src/lib/db/userRepo.ts`: 4 —Å–ª—É—á–∞—è
- `src/lib/services/clubs.ts`: 1 —Å–ª—É—á–∞–π
- `src/lib/services/permissions.ts`: 2 —Å–ª—É—á–∞—è

**–ü—Ä–∏—á–∏–Ω–∞:** Supabase —Ç–∏–ø—ã –Ω–µ –æ–±–Ω–æ–≤–ª–µ–Ω—ã –ø–æ—Å–ª–µ –º–∏–≥—Ä–∞—Ü–∏–π –ë–î

**–†–µ—à–µ–Ω–∏–µ:** 
```bash
npx supabase gen types typescript --project-id djbqwsipllhdydshuokg > src/lib/supabase/database.types.ts
```

–ó–∞—Ç–µ–º –∑–∞–º–µ–Ω–∏—Ç—å –≤—Å–µ `(client as any)` –Ω–∞ –ø—Ä–∞–≤–∏–ª—å–Ω–æ —Ç–∏–ø–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –≤—ã–∑–æ–≤—ã.

---

#### 5. **–î—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã hydrated –¥–∞–Ω–Ω—ã—Ö**

**–ü—Ä–æ–±–ª–µ–º–∞:** –û–¥–∏–Ω –∏ —Ç–æ—Ç –∂–µ —Ç–∏–ø –ø–æ–≤—Ç–æ—Ä—è–µ—Ç—Å—è –≤ 3 –º–µ—Å—Ç–∞—Ö:

```typescript
// src/lib/types/event.ts
city?: { id: string; name: string; region: string | null } | null;

// src/lib/types/club.ts  
city?: { id: string; name: string; region: string | null } | null;

// src/lib/types/user.ts
city?: { id: string; name: string; region: string | null } | null;
```

**–†–µ—à–µ–Ω–∏–µ:** –°–æ–∑–¥–∞—Ç—å –æ–±—â–∏–π —Ç–∏–ø –≤ `src/lib/types/city.ts`:

```typescript
// –í city.ts
export interface CityHydrated {
  id: string;
  name: string;
  region: string | null;
}

// –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –≤–µ–∑–¥–µ
import { CityHydrated } from "@/lib/types/city";

city?: CityHydrated | null;
```

---

#### 6. **–î—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ –ª–æ–≥–∏–∫–∏ hydration**

**–ü—Ä–æ–±–ª–µ–º–∞:** –û–¥–∏–Ω–∞–∫–æ–≤—ã–π –∫–æ–¥ –¥–ª—è batch loading –≥–æ—Ä–æ–¥–æ–≤ –ø–æ–≤—Ç–æ—Ä—è–µ—Ç—Å—è:
- `src/lib/services/events.ts` (—Å—Ç—Ä–æ–∫–∏ 119-132)
- –ù—É–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å –≤ `src/lib/services/clubs.ts`
- –ü–æ—Ç–µ–Ω—Ü–∏–∞–ª—å–Ω–æ –Ω—É–∂–Ω–æ –≤ –¥—Ä—É–≥–∏—Ö –º–µ—Å—Ç–∞—Ö

**–†–µ—à–µ–Ω–∏–µ:** –°–æ–∑–¥–∞—Ç—å utility —Ñ—É–Ω–∫—Ü–∏—é:

```typescript
// src/lib/utils/hydration.ts
import { getCitiesByIds } from "@/lib/db/cityRepo";
import { CityHydrated } from "@/lib/types/city";

export async function hydrateCities<T extends { cityId: string | null }>(
  items: T[]
): Promise<(T & { city: CityHydrated | null })[]> {
  const cityIds = items
    .map(item => item.cityId)
    .filter((id): id is string => id !== null && id !== undefined);
  
  const uniqueCityIds = Array.from(new Set(cityIds));
  
  let citiesMap = new Map<string, any>();
  if (uniqueCityIds.length > 0) {
    try {
      citiesMap = await getCitiesByIds(uniqueCityIds);
    } catch (err) {
      console.error("[hydrateCities] Failed to load cities", err);
    }
  }
  
  return items.map(item => {
    const city = item.cityId ? citiesMap.get(item.cityId) : null;
    return {
      ...item,
      city: city ? { id: city.id, name: city.name, region: city.region } : null,
    };
  });
}
```

---

### üü¢ **–ù–∏–∑–∫–æ–ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã**

#### 7. **TODO –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏ (15 —à—Ç)**

**–ö–∞—Ç–µ–≥–æ—Ä–∏–∏:**
1. **–†–µ–≥–µ–Ω–µ—Ä–∞—Ü–∏—è Supabase —Ç–∏–ø–æ–≤** (5 —à—Ç) - –ø–æ—Å–ª–µ –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—è –º–∏–≥—Ä–∞—Ü–∏–π
2. **–ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è –ø–ª–∞—Ç–µ–∂–Ω–æ–π —Å–∏—Å—Ç–µ–º—ã** (3 —à—Ç) - –±—É–¥—É—â–∞—è —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å
3. **–ó–∞–≥—Ä—É–∑–∫–∞ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏** (2 —à—Ç) - —Ä–∞—Å—à–∏—Ä–µ–Ω–∏–µ —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª–∞
4. **–ü—Ä–æ–≤–µ—Ä–∫–∞ –ø—Ä–∞–≤ –¥–æ—Å—Ç—É–ø–∞** (2 —à—Ç) - —É–ª—É—á—à–µ–Ω–∏–µ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏
5. **–î–æ–±–∞–≤–ª–µ–Ω–∏–µ —Ç–∏–ø–æ–≤** (2 —à—Ç) - –ø–æ—Å–ª–µ —Ä–µ–≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ —Ç–∏–ø–æ–≤
6. **–ü–æ–¥—Å—á–µ—Ç —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤** (1 —à—Ç) - –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è

**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç:** –°–Ω–∞—á–∞–ª–∞ —Ä–µ–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å —Ç–∏–ø—ã, –æ—Å—Ç–∞–ª—å–Ω–æ–µ - –ø–æ –º–µ—Ä–µ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏.

---

#### 8. **–ù–µ–∫–æ–Ω—Å–∏—Å—Ç–µ–Ω—Ç–Ω–æ—Å—Ç—å –≤ –∏–º–µ–Ω–æ–≤–∞–Ω–∏–∏**

**–ü—Ä–æ–±–ª–µ–º–∞:** –°–º–µ—à–∏–≤–∞–Ω–∏–µ —Å—Ç–∏–ª–µ–π:
- `mapDbEventToDomain` vs `mapDbClubToDomain` ‚úÖ (–∫–æ–Ω—Å–∏—Å—Ç–µ–Ω—Ç–Ω–æ)
- `listEvents` vs `listClubs` ‚úÖ (–∫–æ–Ω—Å–∏—Å—Ç–µ–Ω—Ç–Ω–æ)
- `getCurrentUser` vs `getCurrentUserSafe` ‚úÖ (–ø–æ–Ω—è—Ç–Ω–æ–µ —Ä–∞–∑–ª–∏—á–∏–µ)

**–í—ã–≤–æ–¥:** –ò–º–µ–Ω–æ–≤–∞–Ω–∏–µ –≤ —Ü–µ–ª–æ–º –∫–æ–Ω—Å–∏—Å—Ç–µ–Ω—Ç–Ω–æ.

---

#### 9. **–ü–æ—Ç–µ–Ω—Ü–∏–∞–ª—å–Ω–∞—è N+1 –ø—Ä–æ–±–ª–µ–º–∞**

**–§–∞–π–ª:** `src/lib/services/events.ts:138-142`

```typescript
const hydrated = await Promise.all(
  filtered.map(async (event) => {
    let allowedBrands = event.allowedBrands;
    try {
      allowedBrands = await getAllowedBrands(event.id); // N+1!
```

**–ü—Ä–æ–±–ª–µ–º–∞:** –î–ª—è –∫–∞–∂–¥–æ–≥–æ —Å–æ–±—ã—Ç–∏—è –æ—Ç–¥–µ–ª—å–Ω—ã–π –∑–∞–ø—Ä–æ—Å –∫ –ë–î –¥–ª—è `allowedBrands`

**–†–µ—à–µ–Ω–∏–µ:** –°–æ–∑–¥–∞—Ç—å batch —Ñ—É–Ω–∫—Ü–∏—é `getAllowedBrandsByEventIds(eventIds[])`

---

## üìà **–ú–µ—Ç—Ä–∏–∫–∏ –∫–∞—á–µ—Å—Ç–≤–∞ –∫–æ–¥–∞**

| –ú–µ—Ç—Ä–∏–∫–∞ | –ó–Ω–∞—á–µ–Ω–∏–µ | –û—Ü–µ–Ω–∫–∞ |
|---------|----------|--------|
| –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ `as any` | 46 | üü° –°—Ä–µ–¥–Ω–µ |
| TODO –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏ | 15 | üü¢ –•–æ—Ä–æ—à–æ |
| –î—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ –∫–æ–¥–∞ | –ù–∏–∑–∫–æ–µ | üü¢ –•–æ—Ä–æ—à–æ |
| –¢–∏–ø–∏–∑–∞—Ü–∏—è | 85% | üü° –°—Ä–µ–¥–Ω–µ |
| –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ | –ß–∏—Å—Ç–∞—è | üü¢ –û—Ç–ª–∏—á–Ω–æ |
| –†–∞–∑–¥–µ–ª–µ–Ω–∏–µ —Å–ª–æ–µ–≤ | –ß–µ—Ç–∫–æ–µ | üü¢ –û—Ç–ª–∏—á–Ω–æ |

---

## ‚úÖ **–ß—Ç–æ —Å–¥–µ–ª–∞–Ω–æ —Ö–æ—Ä–æ—à–æ**

1. **–ß–µ—Ç–∫–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ —Å–ª–æ–µ–≤:**
   - Repository ‚Üí Service ‚Üí API ‚Üí UI
   - –ö–∞–∂–¥—ã–π —Å–ª–æ–π –∏–º–µ–µ—Ç —Å–≤–æ—é –æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç—å

2. **–ö–æ–Ω—Å–∏—Å—Ç–µ–Ω—Ç–Ω—ã–µ mappers:**
   - `mapDbXToDomain` –ø–∞—Ç—Ç–µ—Ä–Ω –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –≤–µ–∑–¥–µ
   - –ß–µ—Ç–∫–æ–µ —Ä–∞–∑–¥–µ–ª–µ–Ω–∏–µ DB –∏ Domain –º–æ–¥–µ–ª–µ–π

3. **–¶–µ–Ω—Ç—Ä–∞–ª–∏–∑–æ–≤–∞–Ω–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞ –ø—Ä–∞–≤:**
   - `src/lib/services/permissions.ts` - –µ–¥–∏–Ω–∞—è —Ç–æ—á–∫–∞ –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –¥–æ—Å—Ç—É–ø–∞

4. **Batch loading –¥–ª—è –≥–æ—Ä–æ–¥–æ–≤:**
   - –†–µ—à–µ–Ω–∞ N+1 –ø—Ä–æ–±–ª–µ–º–∞ –¥–ª—è –≥–æ—Ä–æ–¥–æ–≤ –≤ events

5. **–ù–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏—è –ë–î:**
   - –ì–æ—Ä–æ–¥–∞, –≤–∞–ª—é—Ç—ã, –±—Ä–µ–Ω–¥—ã - –≤—Å–µ –≤ –æ—Ç–¥–µ–ª—å–Ω—ã—Ö —Ç–∞–±–ª–∏—Ü–∞—Ö
   - FK constraints –æ–±–µ—Å–ø–µ—á–∏–≤–∞—é—Ç —Ü–µ–ª–æ—Å—Ç–Ω–æ—Å—Ç—å

---

## üéØ **–ü–ª–∞–Ω –¥–µ–π—Å—Ç–≤–∏–π (–ø—Ä–∏–æ—Ä–∏—Ç–µ–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–π)**

### –ù–µ–º–µ–¥–ª–µ–Ω–Ω–æ (–¥–æ –ø—Ä–æ–¥–∞–∫—à–µ–Ω–∞):

1. ‚úÖ –ò—Å–ø—Ä–∞–≤–∏—Ç—å –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ `Params` –≤ `events/[id]/route.ts`
2. ‚úÖ –î–æ–±–∞–≤–∏—Ç—å hydration –≥–æ—Ä–æ–¥–æ–≤ –¥–ª—è –∫–ª—É–±–æ–≤
3. ‚ö†Ô∏è –†–µ–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å Supabase —Ç–∏–ø—ã
4. ‚ö†Ô∏è –£–±—Ä–∞—Ç—å `as any` –ø–æ—Å–ª–µ —Ä–µ–≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ —Ç–∏–ø–æ–≤

### –í –±–ª–∏–∂–∞–π—à–µ–µ –≤—Ä–µ–º—è:

5. –°–æ–∑–¥–∞—Ç—å –æ–±—â–∏–π —Ç–∏–ø `CityHydrated`
6. –°–æ–∑–¥–∞—Ç—å utility `hydrateCities()`
7. –î–æ–±–∞–≤–∏—Ç—å batch loading –¥–ª—è `allowedBrands`
8. –î–æ–±–∞–≤–∏—Ç—å batch loading –¥–ª—è –≤–∞–ª—é—Ç (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)

### –ö–æ–≥–¥–∞ –±—É–¥–µ—Ç –≤—Ä–µ–º—è:

9. –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å TODO –ø–æ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–µ
10. –î–æ–±–∞–≤–∏—Ç—å –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—é —Å –ø–ª–∞—Ç–µ–∂–Ω–æ–π —Å–∏—Å—Ç–µ–º–æ–π
11. –£–ª—É—á—à–∏—Ç—å –ø—Ä–æ–≤–µ—Ä–∫–∏ –ø—Ä–∞–≤ –¥–æ—Å—Ç—É–ø–∞

---

## üîí **–ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å**

‚úÖ **–•–æ—Ä–æ—à–æ:**
- –¶–µ–Ω—Ç—Ä–∞–ª–∏–∑–æ–≤–∞–Ω–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞ permissions
- –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø—Ä–∞–≤ –Ω–∞ —É—Ä–æ–≤–Ω–µ service layer
- –í–∞–ª–∏–¥–∞—Ü–∏—è —á–µ—Ä–µ–∑ Zod schemas

‚ö†Ô∏è **–¢—Ä–µ–±—É–µ—Ç –≤–Ω–∏–º–∞–Ω–∏—è:**
- TODO: –ø—Ä–æ–≤–µ—Ä–∫–∞ `event_user_access` —Ç–∞–±–ª–∏—Ü—ã
- TODO: –ø—Ä–æ–≤–µ—Ä–∫–∞ —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤ —Å–æ–±—ã—Ç–∏—è

---

## üöÄ **–ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å**

‚úÖ **–û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–æ:**
- Batch loading –≥–æ—Ä–æ–¥–æ–≤ –¥–ª—è events
- –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ Map –¥–ª—è O(1) lookup

‚ö†Ô∏è **–¢—Ä–µ–±—É–µ—Ç –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏:**
- N+1 –¥–ª—è `allowedBrands` –≤ events
- –û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ batch loading –≤–∞–ª—é—Ç
- –û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ batch loading –≥–æ—Ä–æ–¥–æ–≤ –¥–ª—è clubs

---

## üìù **–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏**

### –í—ã—Å–æ–∫–∏–π –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç:
1. –†–µ–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å —Ç–∏–ø—ã Supabase
2. –î–æ–±–∞–≤–∏—Ç—å city hydration –¥–ª—è clubs
3. –ò—Å–ø—Ä–∞–≤–∏—Ç—å –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ Params

### –°—Ä–µ–¥–Ω–∏–π –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç:
4. –°–æ–∑–¥–∞—Ç—å utility –¥–ª—è hydration
5. –û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞—Ç—å allowedBrands loading
6. –î–æ–±–∞–≤–∏—Ç—å currency hydration

### –ù–∏–∑–∫–∏–π –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç:
7. –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å TODO –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏
8. –î–æ–±–∞–≤–∏—Ç—å —Ç–µ—Å—Ç—ã –¥–ª—è –∫—Ä–∏—Ç–∏—á–Ω—ã—Ö —Ñ—É–Ω–∫—Ü–∏–π
9. –î–æ–∫—É–º–µ–Ω—Ç–∏—Ä–æ–≤–∞—Ç—å API endpoints

---

## üéì **–í—ã–≤–æ–¥—ã**

**–û–±—â–∞—è –æ—Ü–µ–Ω–∫–∞:** üü¢ **8/10 - –•–æ—Ä–æ—à–æ**

–ö–æ–¥–æ–≤–∞—è –±–∞–∑–∞ –≤ —Ü–µ–ª–æ–º –∫–∞—á–µ—Å—Ç–≤–µ–Ω–Ω–∞—è, —Å —á–µ—Ç–∫–æ–π –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–æ–π –∏ —Ö–æ—Ä–æ—à–∏–º —Ä–∞–∑–¥–µ–ª–µ–Ω–∏–µ–º –æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç–∏. –û—Å–Ω–æ–≤–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã —Å–≤—è–∑–∞–Ω—ã —Å:
1. –ù–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç—å—é —Ä–µ–≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ —Ç–∏–ø–æ–≤ –ø–æ—Å–ª–µ –º–∏–≥—Ä–∞—Ü–∏–π
2. –ù–µ–ø–æ–ª–Ω–æ–π —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–µ–π hydration –¥–ª—è –≤—Å–µ—Ö —Å—É—â–Ω–æ—Å—Ç–µ–π
3. –ù–µ—Å–∫–æ–ª—å–∫–∏–º–∏ N+1 –ø—Ä–æ–±–ª–µ–º–∞–º–∏

–í—Å–µ –ø—Ä–æ–±–ª–µ–º—ã —Ä–µ—à–∞–µ–º—ã –∏ –Ω–µ –∫—Ä–∏—Ç–∏—á–Ω—ã –¥–ª—è –∑–∞–ø—É—Å–∫–∞ –≤ –ø—Ä–æ–¥–∞–∫—à–µ–Ω –ø–æ—Å–ª–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è –ø—É–Ω–∫—Ç–æ–≤ 1-3 –∏–∑ —Ä–∞–∑–¥–µ–ª–∞ "–ù–µ–º–µ–¥–ª–µ–Ω–Ω–æ".

