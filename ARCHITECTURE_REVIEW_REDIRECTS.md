# Architecture Review: Form Submit Redirects

## –ù–∞–π–¥–µ–Ω–Ω–∞—è –ø—Ä–æ–±–ª–µ–º–∞

**–î–∞—Ç–∞:** 17 –¥–µ–∫–∞–±—Ä—è 2024
**–ö–æ–º–ø–æ–Ω–µ–Ω—Ç:** EventForm –∏ –µ–≥–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ

### –û–ø–∏—Å–∞–Ω–∏–µ –ø—Ä–æ–±–ª–µ–º—ã

–ü–µ—Ä–µ–∏—Å–ø–æ–ª—å–∑—É–µ–º—ã–π –∫–æ–º–ø–æ–Ω–µ–Ω—Ç `EventForm` –¥–µ–ª–∞–ª —Ä–µ–¥–∏—Ä–µ–∫—Ç —Å–∞–º –ø–æ—Å–ª–µ —É—Å–ø–µ—à–Ω–æ–≥–æ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è:

```typescript
try {
  await onSubmit(payload);
  router.push(backHref);    // ‚ùå –ù–∞—Ä—É—à–µ–Ω–∏–µ SRP
  router.refresh();         // ‚ùå –ö–æ–º–ø–æ–Ω–µ–Ω—Ç –Ω–µ –¥–æ–ª–∂–µ–Ω –∑–Ω–∞—Ç—å –æ –Ω–∞–≤–∏–≥–∞—Ü–∏–∏
} catch (err) { ... }
```

### –ü–æ—Å–ª–µ–¥—Å—Ç–≤–∏—è

1. **–î–≤–æ–π–Ω–æ–π —Ä–µ–¥–∏—Ä–µ–∫—Ç** –≤ create flow:
   - `EventForm` –¥–µ–ª–∞–µ—Ç `router.push(backHref)`
   - `create-event-page-content` —Ç–æ–∂–µ –¥–µ–ª–∞–µ—Ç `router.push('/events')`
   - –ö–æ–Ω—Ñ–ª–∏–∫—Ç: –æ–∫–Ω–æ –Ω–µ –∑–∞–∫—Ä—ã–≤–∞–µ—Ç—Å—è

2. **–û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è** –≤ edit flow:
   - `EventForm` –¥–µ–ª–∞–µ—Ç —Ä–µ–¥–∏—Ä–µ–∫—Ç
   - `edit/page` –Ω–µ –æ–±–Ω–æ–≤–ª—è–µ—Ç –¥–∞–Ω–Ω—ã–µ –ø–æ—Å–ª–µ PUT
   - –°—Ç–∞—Ä—ã–µ –¥–∞–Ω–Ω—ã–µ –æ—Ç–æ–±—Ä–∞–∂–∞—é—Ç—Å—è

### –†–µ—à–µ–Ω–∏–µ

**–ü—Ä–∏–Ω—Ü–∏–ø:** –†–æ–¥–∏—Ç–µ–ª—å—Å–∫–∏–π –∫–æ–º–ø–æ–Ω–µ–Ω—Ç –∫–æ–Ω—Ç—Ä–æ–ª–∏—Ä—É–µ—Ç –Ω–∞–≤–∏–≥–∞—Ü–∏—é, –ø–µ—Ä–µ–∏—Å–ø–æ–ª—å–∑—É–µ–º—ã–π –∫–æ–º–ø–æ–Ω–µ–Ω—Ç - –Ω–µ—Ç.

```typescript
// EventForm (–ø–µ—Ä–µ–∏—Å–ø–æ–ª—å–∑—É–µ–º—ã–π)
try {
  await onSubmit(payload);
  // –†–µ–¥–∏—Ä–µ–∫—Ç –¥–µ–ª–∞–µ—Ç —Ä–æ–¥–∏—Ç–µ–ª—å
} catch (err) { ... }

// edit/page (—Ä–æ–¥–∏—Ç–µ–ª—å)
const handleSubmit = async (payload) => {
  await fetch(...);
  router.push(`/events/${id}`);  // ‚úÖ –†–µ–¥–∏—Ä–µ–∫—Ç –∑–¥–µ—Å—å
  router.refresh();               // ‚úÖ –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∑–¥–µ—Å—å
};
```

---

## –ê—É–¥–∏—Ç: –ì–¥–µ –µ—â—ë –∏—Å–∫–∞—Ç—å —Ç–∞–∫–∏–µ –ø—Ä–æ–±–ª–µ–º—ã

### –ö—Ä–∏—Ç–µ—Ä–∏–∏ –ø–æ–∏—Å–∫–∞

–ò—â–µ–º –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã –∫–æ—Ç–æ—Ä—ã–µ:
1. –ü—Ä–∏–Ω–∏–º–∞—é—Ç `onSubmit` prop
2. –î–µ–ª–∞—é—Ç `router.push` –ø–æ—Å–ª–µ —É—Å–ø–µ—à–Ω–æ–≥–æ `onSubmit`
3. –ü–µ—Ä–µ–∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è –≤ —Ä–∞–∑–Ω—ã—Ö –º–µ—Å—Ç–∞—Ö

### –ö–æ–º–ø–æ–Ω–µ–Ω—Ç—ã –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏

#### ‚úÖ –ü—Ä–æ–≤–µ—Ä–µ–Ω–æ

- [x] `EventForm` - **–ò–°–ü–†–ê–í–õ–ï–ù–û**
- [x] `create-event-page-content` - OK (—Ä–æ–¥–∏—Ç–µ–ª—å, –¥–æ–ª–∂–µ–Ω —Ä–µ–¥–∏—Ä–µ–∫—Ç–∏—Ç—å)
- [x] `edit/page (events)` - **–ò–°–ü–†–ê–í–õ–ï–ù–û**

#### üîç –¢—Ä–µ–±—É—é—Ç –ø—Ä–æ–≤–µ—Ä–∫–∏

- [ ] `ParticipantForm` / `ParticipantModal`
  - –ü—É—Ç—å: `src/components/events/participant-form.tsx`
  - –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ: –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –Ω–∞ —Å–æ–±—ã—Ç–∏–µ
  - –ü—Ä–æ–≤–µ—Ä–∏—Ç—å: –¥–µ–ª–∞–µ—Ç –ª–∏ —Ä–µ–¥–∏—Ä–µ–∫—Ç –ø–æ—Å–ª–µ —É—Å–ø–µ—à–Ω–æ–π —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏?

- [ ] `ProfileForm` / Profile editing
  - –ü—É—Ç—å: `src/app/profile/edit/page.tsx`
  - –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ: –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –ø—Ä–æ—Ñ–∏–ª—è
  - –ü—Ä–æ–≤–µ—Ä–∏—Ç—å: –∫–∞–∫ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç—Å—è —É—Å–ø–µ—à–Ω–æ–µ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ?

- [ ] `ClubForm` (–µ—Å–ª–∏ –µ—Å—Ç—å)
  - –ü—É—Ç—å: `src/components/clubs/` –∏–ª–∏ `src/app/clubs/`
  - –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ: –°–æ–∑–¥–∞–Ω–∏–µ/—Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∫–ª—É–±–æ–≤
  - –ü—Ä–æ–≤–µ—Ä–∏—Ç—å: –ø–∞—Ç—Ç–µ—Ä–Ω –Ω–∞–≤–∏–≥–∞—Ü–∏–∏

- [ ] –î—Ä—É–≥–∏–µ —Ñ–æ—Ä–º—ã —Å `onSubmit`
  - –ü–æ–∏—Å–∫: `grep -r "onSubmit.*Promise" src/components/`
  - –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∫–∞–∂–¥—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç

### –ö–æ–º–∞–Ω–¥–∞ –¥–ª—è –ø–æ–∏—Å–∫–∞

```bash
# –ù–∞–π—Ç–∏ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã —Å onSubmit prop
grep -r "onSubmit:" src/components/ --include="*.tsx" -A 5

# –ù–∞–π—Ç–∏ router.push –ø–æ—Å–ª–µ onSubmit
grep -r "router.push" src/components/ --include="*.tsx" -B 10 | grep -B 10 "onSubmit"
```

---

## –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏

### –î–ª—è –Ω–æ–≤—ã—Ö –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤

1. **–ü–µ—Ä–µ–∏—Å–ø–æ–ª—å–∑—É–µ–º—ã–µ —Ñ–æ—Ä–º—ã** –ù–ï –¥–æ–ª–∂–Ω—ã –¥–µ–ª–∞—Ç—å —Ä–µ–¥–∏—Ä–µ–∫—Ç
   ```typescript
   // ‚ùå –ü–ª–æ—Ö–æ
   const MyForm = ({ onSubmit }) => {
     const handleSubmit = async () => {
       await onSubmit(data);
       router.push('/somewhere');  // ‚ùå
     };
   };
   
   // ‚úÖ –•–æ—Ä–æ—à–æ
   const MyForm = ({ onSubmit }) => {
     const handleSubmit = async () => {
       await onSubmit(data);
       // –†–µ–¥–∏—Ä–µ–∫—Ç –¥–µ–ª–∞–µ—Ç —Ä–æ–¥–∏—Ç–µ–ª—å
     };
   };
   ```

2. **–†–æ–¥–∏—Ç–µ–ª—å—Å–∫–∏–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã** –∫–æ–Ω—Ç—Ä–æ–ª–∏—Ä—É—é—Ç –Ω–∞–≤–∏–≥–∞—Ü–∏—é
   ```typescript
   // ‚úÖ –ü—Ä–∞–≤–∏–ª—å–Ω–æ
   const ParentPage = () => {
     const router = useRouter();
     
     const handleSubmit = async (data) => {
       await api.save(data);
       router.push('/success');    // ‚úÖ –†–æ–¥–∏—Ç–µ–ª—å —Ä–µ—à–∞–µ—Ç
       router.refresh();            // ‚úÖ –†–æ–¥–∏—Ç–µ–ª—å –æ–±–Ω–æ–≤–ª—è–µ—Ç
     };
     
     return <MyForm onSubmit={handleSubmit} />;
   };
   ```

3. **–ú–æ–¥–∞–ª—å–Ω—ã–µ —Ñ–æ—Ä–º—ã** –º–æ–≥—É—Ç –∑–∞–∫—Ä—ã–≤–∞—Ç—å —Å–µ–±—è
   ```typescript
   // ‚úÖ –î–æ–ø—É—Å—Ç–∏–º–æ –¥–ª—è –º–æ–¥–∞–ª–æ–∫
   const Modal = ({ onClose, onSubmit }) => {
     const handleSubmit = async () => {
       await onSubmit(data);
       onClose();  // ‚úÖ –ú–æ–¥–∞–ª–∫–∞ –º–æ–∂–µ—Ç –∑–∞–∫—Ä—ã—Ç—å—Å—è
     };
   };
   ```

---

## Checklist –¥–ª—è Code Review

–ü—Ä–∏ —Ä–µ–≤—å—é –Ω–æ–≤—ã—Ö —Ñ–æ—Ä–º –ø—Ä–æ–≤–µ—Ä—è—Ç—å:

- [ ] –ö–æ–º–ø–æ–Ω–µ–Ω—Ç –ø–µ—Ä–µ–∏—Å–ø–æ–ª—å–∑—É–µ–º—ã–π? ‚Üí –ù–ï –¥–æ–ª–∂–µ–Ω –¥–µ–ª–∞—Ç—å —Ä–µ–¥–∏—Ä–µ–∫—Ç
- [ ] –ö–æ–º–ø–æ–Ω–µ–Ω—Ç —Å—Ç—Ä–∞–Ω–∏—Ü–∞ (page.tsx)? ‚Üí –î–æ–ª–∂–µ–Ω –∫–æ–Ω—Ç—Ä–æ–ª–∏—Ä–æ–≤–∞—Ç—å –Ω–∞–≤–∏–≥–∞—Ü–∏—é
- [ ] –ï—Å—Ç—å `router.push` –≤ `try` –±–ª–æ–∫–µ? ‚Üí –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —á—Ç–æ —ç—Ç–æ —Ä–æ–¥–∏—Ç–µ–ª—å
- [ ] –ï—Å—Ç—å –¥–≤–æ–π–Ω–æ–π —Ä–µ–¥–∏—Ä–µ–∫—Ç? ‚Üí –£–±—Ä–∞—Ç—å –∏–∑ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞, –æ—Å—Ç–∞–≤–∏—Ç—å –≤ —Ä–æ–¥–∏—Ç–µ–ª–µ
- [ ] –ï—Å—Ç—å `router.refresh()` –ø–æ—Å–ª–µ —Ä–µ–¥–∏—Ä–µ–∫—Ç–∞? ‚Üí –û–±—è–∑–∞—Ç–µ–ª—å–Ω–æ –¥–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö

---

## –ò—Å—Ç–æ—Ä–∏—è –∏–∑–º–µ–Ω–µ–Ω–∏–π

- **2024-12-17**: –ù–∞–π–¥–µ–Ω–∞ –∏ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∞ –ø—Ä–æ–±–ª–µ–º–∞ –≤ EventForm
- **2024-12-17**: –°–æ–∑–¥–∞–Ω —ç—Ç–æ—Ç –¥–æ–∫—É–º–µ–Ω—Ç –¥–ª—è –∞—É–¥–∏—Ç–∞

---

## TODO: –ü–æ–ª–Ω—ã–π –∞—É–¥–∏—Ç

- [ ] –ü—Ä–æ–π—Ç–∏—Å—å –ø–æ –≤—Å–µ–º —Ñ–æ—Ä–º–∞–º –≤ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏
- [ ] –ù–∞–π—Ç–∏ –≤—Å–µ —Å–ª—É—á–∞–∏ `router.push` –≤ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞—Ö
- [ ] –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ –ø—Ä–∏–Ω—Ü–∏–ø—É SRP
- [ ] –î–æ–∫—É–º–µ–Ω—Ç–∏—Ä–æ–≤–∞—Ç—å –Ω–∞–π–¥–µ–Ω–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã
- [ ] –ò—Å–ø—Ä–∞–≤–∏—Ç—å –ø–æ –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç—É
